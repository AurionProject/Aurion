<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project name="AdapterDocRetrieve-Test12312" resourceRoot="" soapui-version="4.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterDocRetrieveBindingSoap11" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapterdocretrieve}AdapterDocRetrieveBindingSoap11" soapVersion="1_1" anonymous="optional" definition="http://192.168.25.157:9080/NhinConnect/AdapterDocRetrieve?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/AdapterDocRetrieve</con:endpoint><con:endpoint>http://192.168.25.219:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:endpoint>http://dvanhie3.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:RespondingGateway_CrossGatewayRetrieve" name="RespondingGateway_CrossGatewayRetrieve" bindingOperationName="RespondingGateway_CrossGatewayRetrieve" type="Request-Response" outputName="RespondingGateway_CrossGatewayRetrieveResponse" inputName="RespondingGateway_CrossGatewayRetrieveRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:testSuite name="AdapterDocRetrieve TestSuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="11.3.1.UT.2 - Single Doc" searchProperties="true" id="2224e438-a4b5-40cf-9e0b-dc21ae606d78"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/AdapterDocQuery-Test12310.properties</con:source><con:properties><con:property><con:name>DocQueryEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocRetrieveEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>SingleDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MultiDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalAA</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCName</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>sigDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>expireDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NoDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NonExistentPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>TooManyResultsPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>RepositoryUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="get Dates"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
sigDateStr = sdf.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate patient ID for Doc Query"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalAA = propertyList.getPropertyValue( "LocalAA" );
def PatientID = propertyList.getPropertyValue( "MultiDocPatientID" );

fullPatientID = "'" + PatientID + "^^^&amp;" + LocalAA + "&amp;ISO'";
groovyUtils.setPropertyValue( "Test Case Properties", "FullPatientID", fullPatientID);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate HCID with prefix"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalHCID = propertyList.getPropertyValue( "LocalHCID" );

fullHCID = "urn:oid:" + LocalHCID;
groovyUtils.setPropertyValue( "Test Case Properties", "FullHCID", fullHCID);
</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>endpoint</con:name><con:sourceType>DocRetrieveEndpoint</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath/></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" transferToAll="false" ignoreEmpty="false" useXQuery="false" transferChildNodes="false"><con:name>HCName</con:name><con:sourceType>LocalHCName</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:userInfo[1]/ns6:org[1]/ns6:name[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>signatureDate</con:name><con:sourceType>sigDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:dateOfSignature[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>expirationDate</con:name><con:sourceType>expireDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:expirationDate[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>HomeCommunityId</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false"><con:name>DocumentUniqueId</con:name><con:sourceType>DocumentUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="Adapter_CrossGatewayRetrieve"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocRetrieveBindingSoap11</con:interface><con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation><con:request name="Adapter_CrossGatewayRetrieve"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://dodadapter.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:request><![CDATA[<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
   <SOAP-ENV:Header/>
   <SOAP-ENV:Body>
      <ns1:RespondingGateway_CrossGatewayRetrieveRequest xmlns:msgns="urn:gov:hhs:fha:nhinc:adapterdocretrieve" xmlns:ns1="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter">
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.1.11111</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns1:assertion xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns6:dateOfSignature>2009-05-19T21:15:02Z</ns6:dateOfSignature>
            <ns6:expirationDate>2009-06-18T21:20:02Z</ns6:expirationDate>
            <ns6:haveSecondWitnessSignature>false</ns6:haveSecondWitnessSignature>
            <ns6:haveSignature>false</ns6:haveSignature>
            <ns6:haveWitnessSignature>false</ns6:haveWitnessSignature>
            <ns6:userInfo>
               <ns6:personName>
                  <ns6:familyName>FRANKLIN</ns6:familyName>
                  <ns6:givenName>MARK</ns6:givenName>
                  <ns6:secondNameOrInitials>ALAN</ns6:secondNameOrInitials>
               </ns6:personName>
               <ns6:userName>mfranklin</ns6:userName>
               <ns6:org>
                  <ns6:name>InternalTest1</ns6:name>
               </ns6:org>
               <ns6:roleCoded>
                  <ns6:code>80584001</ns6:code>
                  <ns6:codeSystem>2.16.840.1.113883.6.96</ns6:codeSystem>
                  <ns6:codeSystemName>SNOMED_CT</ns6:codeSystemName>
                  <ns6:displayName>Psychiatrist</ns6:displayName>
               </ns6:roleCoded>
            </ns6:userInfo>
            <ns6:authorized>false</ns6:authorized>
            <ns6:purposeOfDisclosureCoded>
               <ns6:code>PSYCHOTHERAPY</ns6:code>
               <ns6:codeSystem>2.16.840.1.113883.3.18.7.1</ns6:codeSystem>
               <ns6:codeSystemName>nhin-purpose</ns6:codeSystemName>
               <ns6:displayName>Use or disclosure of Psychotherapy Notes</ns6:displayName>
            </ns6:purposeOfDisclosureCoded>
            <ns6:claimFormRef>Ref-Clm-123</ns6:claimFormRef>
            <ns6:claimFormRaw>YWVvbGlhbQ==</ns6:claimFormRaw>
         </ns1:assertion>
      </ns1:RespondingGateway_CrossGatewayRetrieveRequest>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
def documentData = holder["//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:Document[1]"]
assert documentData != null</scriptText></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xds-b:2007';
declare namespace ns2='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
//ns1:RetrieveDocumentSetResponse[1]/ns2:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="11.3.1.UT.4 - Document Persistence" searchProperties="true" id="a6bf7d5e-e41e-4413-a300-c0b7777c45fb"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/AdapterDocQuery-Test12310.properties</con:source><con:properties><con:property><con:name>DocQueryEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocRetrieveEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>SingleDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MultiDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalAA</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCName</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>sigDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>expireDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NoDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NonExistentPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>TooManyResultsPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>RepositoryUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MissingDocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="get Dates"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
sigDateStr = sdf.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate patient ID for Doc Query"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalAA = propertyList.getPropertyValue( "LocalAA" );
def PatientID = propertyList.getPropertyValue( "MultiDocPatientID" );

fullPatientID = "'" + PatientID + "^^^&amp;" + LocalAA + "&amp;ISO'";
groovyUtils.setPropertyValue( "Test Case Properties", "FullPatientID", fullPatientID);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate HCID with prefix"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalHCID = propertyList.getPropertyValue( "LocalHCID" );

fullHCID = "urn:oid:" + LocalHCID;
groovyUtils.setPropertyValue( "Test Case Properties", "FullHCID", fullHCID);
</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>endpoint</con:name><con:sourceType>DocRetrieveEndpoint</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath/></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" transferToAll="false" ignoreEmpty="false" useXQuery="false" transferChildNodes="false"><con:name>HCName</con:name><con:sourceType>LocalHCName</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:userInfo[1]/ns6:org[1]/ns6:name[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>signatureDate</con:name><con:sourceType>sigDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:dateOfSignature[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>expirationDate</con:name><con:sourceType>expireDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:expirationDate[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>HomeCommunityId</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false"><con:name>DocumentUniqueId</con:name><con:sourceType>DocumentUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="Adapter_CrossGatewayRetrieve"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocRetrieveBindingSoap11</con:interface><con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation><con:request name="Adapter_CrossGatewayRetrieve"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://dodadapter.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:request><![CDATA[<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
   <SOAP-ENV:Header/>
   <SOAP-ENV:Body>
      <ns1:RespondingGateway_CrossGatewayRetrieveRequest xmlns:msgns="urn:gov:hhs:fha:nhinc:adapterdocretrieve" xmlns:ns1="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter">
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.1.11111</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns1:assertion xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns6:dateOfSignature>2009-05-19T21:20:41Z</ns6:dateOfSignature>
            <ns6:expirationDate>2009-06-18T21:25:41Z</ns6:expirationDate>
            <ns6:haveSecondWitnessSignature>false</ns6:haveSecondWitnessSignature>
            <ns6:haveSignature>false</ns6:haveSignature>
            <ns6:haveWitnessSignature>false</ns6:haveWitnessSignature>
            <ns6:userInfo>
               <ns6:personName>
                  <ns6:familyName>FRANKLIN</ns6:familyName>
                  <ns6:givenName>MARK</ns6:givenName>
                  <ns6:secondNameOrInitials>ALAN</ns6:secondNameOrInitials>
               </ns6:personName>
               <ns6:userName>mfranklin</ns6:userName>
               <ns6:org>
                  <ns6:name>InternalTest1</ns6:name>
               </ns6:org>
               <ns6:roleCoded>
                  <ns6:code>80584001</ns6:code>
                  <ns6:codeSystem>2.16.840.1.113883.6.96</ns6:codeSystem>
                  <ns6:codeSystemName>SNOMED_CT</ns6:codeSystemName>
                  <ns6:displayName>Psychiatrist</ns6:displayName>
               </ns6:roleCoded>
            </ns6:userInfo>
            <ns6:authorized>false</ns6:authorized>
            <ns6:purposeOfDisclosureCoded>
               <ns6:code>PSYCHOTHERAPY</ns6:code>
               <ns6:codeSystem>2.16.840.1.113883.3.18.7.1</ns6:codeSystem>
               <ns6:codeSystemName>nhin-purpose</ns6:codeSystemName>
               <ns6:displayName>Use or disclosure of Psychotherapy Notes</ns6:displayName>
            </ns6:purposeOfDisclosureCoded>
            <ns6:claimFormRef>Ref-Clm-123</ns6:claimFormRef>
            <ns6:claimFormRaw>YWVvbGlhbQ==</ns6:claimFormRaw>
         </ns1:assertion>
      </ns1:RespondingGateway_CrossGatewayRetrieveRequest>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
def documentData = holder["//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:Document[1]"]
assert documentData != null</scriptText></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xds-b:2007';
declare namespace ns2='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
//ns1:RetrieveDocumentSetResponse[1]/ns2:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="11.4.1.UT.2 - Missing Document" searchProperties="true" id="ccc0cc4d-772c-4ab3-8e0d-7354e8ad8060"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/AdapterDocQuery-Test12310.properties</con:source><con:properties><con:property><con:name>DocQueryEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocRetrieveEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>SingleDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MultiDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalAA</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCName</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>sigDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>expireDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NoDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NonExistentPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>TooManyResultsPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>RepositoryUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MissingDocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="get Dates"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
sigDateStr = sdf.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate patient ID for Doc Query"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalAA = propertyList.getPropertyValue( "LocalAA" );
def PatientID = propertyList.getPropertyValue( "MultiDocPatientID" );

fullPatientID = "'" + PatientID + "^^^&amp;" + LocalAA + "&amp;ISO'";
groovyUtils.setPropertyValue( "Test Case Properties", "FullPatientID", fullPatientID);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate HCID with prefix"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalHCID = propertyList.getPropertyValue( "LocalHCID" );

fullHCID = "urn:oid:" + LocalHCID;
groovyUtils.setPropertyValue( "Test Case Properties", "FullHCID", fullHCID);
</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>endpoint</con:name><con:sourceType>DocRetrieveEndpoint</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath/></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" transferToAll="false" ignoreEmpty="false" useXQuery="false" transferChildNodes="false"><con:name>HCName</con:name><con:sourceType>LocalHCName</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:userInfo[1]/ns6:org[1]/ns6:name[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>signatureDate</con:name><con:sourceType>sigDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:dateOfSignature[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>expirationDate</con:name><con:sourceType>expireDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:expirationDate[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>HomeCommunityId</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" ignoreEmpty="false" transferToAll="false" useXQuery="false" transferChildNodes="false"><con:name>DocumentUniqueId</con:name><con:sourceType>MissingDocumentUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="Adapter_CrossGatewayRetrieve"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocRetrieveBindingSoap11</con:interface><con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation><con:request name="Adapter_CrossGatewayRetrieve"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://dodadapter.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:request><![CDATA[<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
   <SOAP-ENV:Header/>
   <SOAP-ENV:Body>
      <ns1:RespondingGateway_CrossGatewayRetrieveRequest xmlns:msgns="urn:gov:hhs:fha:nhinc:adapterdocretrieve" xmlns:ns1="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter">
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.1.50000</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns1:assertion xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns6:dateOfSignature>2009-05-19T21:17:51Z</ns6:dateOfSignature>
            <ns6:expirationDate>2009-06-18T21:22:51Z</ns6:expirationDate>
            <ns6:haveSecondWitnessSignature>false</ns6:haveSecondWitnessSignature>
            <ns6:haveSignature>false</ns6:haveSignature>
            <ns6:haveWitnessSignature>false</ns6:haveWitnessSignature>
            <ns6:userInfo>
               <ns6:personName>
                  <ns6:familyName>FRANKLIN</ns6:familyName>
                  <ns6:givenName>MARK</ns6:givenName>
                  <ns6:secondNameOrInitials>ALAN</ns6:secondNameOrInitials>
               </ns6:personName>
               <ns6:userName>mfranklin</ns6:userName>
               <ns6:org>
                  <ns6:name>InternalTest1</ns6:name>
               </ns6:org>
               <ns6:roleCoded>
                  <ns6:code>80584001</ns6:code>
                  <ns6:codeSystem>2.16.840.1.113883.6.96</ns6:codeSystem>
                  <ns6:codeSystemName>SNOMED_CT</ns6:codeSystemName>
                  <ns6:displayName>Psychiatrist</ns6:displayName>
               </ns6:roleCoded>
            </ns6:userInfo>
            <ns6:authorized>false</ns6:authorized>
            <ns6:purposeOfDisclosureCoded>
               <ns6:code>PSYCHOTHERAPY</ns6:code>
               <ns6:codeSystem>2.16.840.1.113883.3.18.7.1</ns6:codeSystem>
               <ns6:codeSystemName>nhin-purpose</ns6:codeSystemName>
               <ns6:displayName>Use or disclosure of Psychotherapy Notes</ns6:displayName>
            </ns6:purposeOfDisclosureCoded>
            <ns6:claimFormRef>Ref-Clm-123</ns6:claimFormRef>
            <ns6:claimFormRaw>YWVvbGlhbQ==</ns6:claimFormRaw>
         </ns1:assertion>
      </ns1:RespondingGateway_CrossGatewayRetrieveRequest>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
def documentData = holder["//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:Document[1]"]
assert documentData != null</scriptText></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xds-b:2007';
declare namespace ns2='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
//ns1:RetrieveDocumentSetResponse[1]/ns2:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="11.3.2.UT.2 - Multiple Doc unique community ID one set" searchProperties="true" id="f04c6d05-334c-4c1a-b59d-1af63ee281eb"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/AdapterDocQuery-Test12310.properties</con:source><con:properties><con:property><con:name>DocQueryEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocRetrieveEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>SingleDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MultiDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalAA</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCName</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>sigDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>expireDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NoDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NonExistentPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>TooManyResultsPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>RepositoryUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId2</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MissingDocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="get Dates"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
sigDateStr = sdf.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate patient ID for Doc Query"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalAA = propertyList.getPropertyValue( "LocalAA" );
def PatientID = propertyList.getPropertyValue( "MultiDocPatientID" );

fullPatientID = "'" + PatientID + "^^^&amp;" + LocalAA + "&amp;ISO'";
groovyUtils.setPropertyValue( "Test Case Properties", "FullPatientID", fullPatientID);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate HCID with prefix"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalHCID = propertyList.getPropertyValue( "LocalHCID" );

fullHCID = "urn:oid:" + LocalHCID;
groovyUtils.setPropertyValue( "Test Case Properties", "FullHCID", fullHCID);
</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>endpoint</con:name><con:sourceType>DocRetrieveEndpoint</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath/></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" transferToAll="false" ignoreEmpty="false" useXQuery="false" transferChildNodes="false"><con:name>HCName</con:name><con:sourceType>LocalHCName</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:userInfo[1]/ns6:org[1]/ns6:name[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>signatureDate</con:name><con:sourceType>sigDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:dateOfSignature[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>expirationDate</con:name><con:sourceType>expireDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:expirationDate[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>HomeCommunityId</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false"><con:name>DocumentUniqueId</con:name><con:sourceType>DocumentUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>HomeCommunityId2</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[2]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId2</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[2]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>DocumentUniqueId2</con:name><con:sourceType>DocumentUniqueId2</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[2]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="Adapter_CrossGatewayRetrieve"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocRetrieveBindingSoap11</con:interface><con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation><con:request name="Adapter_CrossGatewayRetrieve"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://dodadapter.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:request><![CDATA[<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
   <SOAP-ENV:Header/>
   <SOAP-ENV:Body>
      <ns1:RespondingGateway_CrossGatewayRetrieveRequest xmlns:msgns="urn:gov:hhs:fha:nhinc:adapterdocretrieve" xmlns:ns1="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter">
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.3.11111</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.3.22222</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns1:assertion xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns6:dateOfSignature>2009-05-19T21:54:52Z</ns6:dateOfSignature>
            <ns6:expirationDate>2009-06-18T21:59:52Z</ns6:expirationDate>
            <ns6:haveSecondWitnessSignature>false</ns6:haveSecondWitnessSignature>
            <ns6:haveSignature>false</ns6:haveSignature>
            <ns6:haveWitnessSignature>false</ns6:haveWitnessSignature>
            <ns6:userInfo>
               <ns6:personName>
                  <ns6:familyName>FRANKLIN</ns6:familyName>
                  <ns6:givenName>MARK</ns6:givenName>
                  <ns6:secondNameOrInitials>ALAN</ns6:secondNameOrInitials>
               </ns6:personName>
               <ns6:userName>mfranklin</ns6:userName>
               <ns6:org>
                  <ns6:name>InternalTest1</ns6:name>
               </ns6:org>
               <ns6:roleCoded>
                  <ns6:code>80584001</ns6:code>
                  <ns6:codeSystem>2.16.840.1.113883.6.96</ns6:codeSystem>
                  <ns6:codeSystemName>SNOMED_CT</ns6:codeSystemName>
                  <ns6:displayName>Psychiatrist</ns6:displayName>
               </ns6:roleCoded>
            </ns6:userInfo>
            <ns6:authorized>false</ns6:authorized>
            <ns6:purposeOfDisclosureCoded>
               <ns6:code>PSYCHOTHERAPY</ns6:code>
               <ns6:codeSystem>2.16.840.1.113883.3.18.7.1</ns6:codeSystem>
               <ns6:codeSystemName>nhin-purpose</ns6:codeSystemName>
               <ns6:displayName>Use or disclosure of Psychotherapy Notes</ns6:displayName>
            </ns6:purposeOfDisclosureCoded>
            <ns6:claimFormRef>Ref-Clm-123</ns6:claimFormRef>
            <ns6:claimFormRaw>YWVvbGlhbQ==</ns6:claimFormRaw>
         </ns1:assertion>
      </ns1:RespondingGateway_CrossGatewayRetrieveRequest>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
def documentData = holder["//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:Document[1]"]
assert documentData != null</scriptText></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xds-b:2007';
declare namespace ns2='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
//ns1:RetrieveDocumentSetResponse[1]/ns2:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="11.3.2.UT.4 - Multiple Doc unique community ID multiple set" searchProperties="true" id="b1e96c02-eef1-4e87-bfcd-e32c5b253fbb"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/AdapterDocQuery-Test12310.properties</con:source><con:properties><con:property><con:name>DocQueryEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocRetrieveEndpoint</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>SingleDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MultiDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalAA</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>LocalHCName</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>sigDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>expireDate</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NoDocPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>NonExistentPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>TooManyResultsPatientID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>FullHCID</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>RepositoryUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>DocumentUniqueId2</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>MissingDocumentUniqueId</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="get Dates"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
sdf.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = new GregorianCalendar();
nowDate = new Date();

cal.setTime(nowDate);
cal.add(Calendar.MINUTE, -5);
startDate = cal.getTime();
sigDateStr = sdf.format(startDate);

cal.setTime(nowDate);
cal.add(Calendar.DATE, 30);
expireDate = cal.getTime();
expireDateStr = sdf.format(expireDate);

groovyUtils.setPropertyValue( "Test Case Properties", "sigDate", sigDateStr);
groovyUtils.setPropertyValue( "Test Case Properties", "expireDate", expireDateStr);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate patient ID for Doc Query"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalAA = propertyList.getPropertyValue( "LocalAA" );
def PatientID = propertyList.getPropertyValue( "MultiDocPatientID" );

fullPatientID = "'" + PatientID + "^^^&amp;" + LocalAA + "&amp;ISO'";
groovyUtils.setPropertyValue( "Test Case Properties", "FullPatientID", fullPatientID);
</script></con:config></con:testStep><con:testStep type="groovy" name="Generate HCID with prefix"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def propertyList = testRunner.testCase.getTestStepByName( "Test Case Properties" );
def LocalHCID = propertyList.getPropertyValue( "LocalHCID" );

fullHCID = "urn:oid:" + LocalHCID;
groovyUtils.setPropertyValue( "Test Case Properties", "FullHCID", fullHCID);
</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>endpoint</con:name><con:sourceType>DocRetrieveEndpoint</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath/></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" transferToAll="false" ignoreEmpty="false" useXQuery="false" transferChildNodes="false"><con:name>HCName</con:name><con:sourceType>LocalHCName</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:userInfo[1]/ns6:org[1]/ns6:name[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>signatureDate</con:name><con:sourceType>sigDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:dateOfSignature[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>expirationDate</con:name><con:sourceType>expireDate</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns6='urn:gov:hhs:fha:nhinc:common:nhinccommon';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns1:assertion[1]/ns6:expirationDate[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>HomeCommunityId</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false" ignoreEmpty="false" transferToAll="false" useXQuery="false" transferChildNodes="false"><con:name>DocumentUniqueId</con:name><con:sourceType>DocumentUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[1]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>HomeCommunityId2</con:name><con:sourceType>FullHCID</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[2]/ns13:DocumentRequest[1]/ns13:HomeCommunityId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>RepositoryUniqueId2</con:name><con:sourceType>RepositoryUniqueId</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[2]/ns13:DocumentRequest[1]/ns13:RepositoryUniqueId[1]</con:targetPath></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>DocumentUniqueId2</con:name><con:sourceType>DocumentUniqueId2</con:sourceType><con:sourceStep>Test Case Properties</con:sourceStep><con:sourcePath xsi:nil="true"/><con:targetType>Request</con:targetType><con:targetStep>Adapter_CrossGatewayRetrieve</con:targetStep><con:targetPath>declare namespace ns13='urn:ihe:iti:xds-b:2007';
declare namespace ns1='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
//ns1:RespondingGateway_CrossGatewayRetrieveRequest[1]/ns13:RetrieveDocumentSetRequest[2]/ns13:DocumentRequest[1]/ns13:DocumentUniqueId[1]</con:targetPath></con:transfers></con:config></con:testStep><con:testStep type="request" name="Adapter_CrossGatewayRetrieve"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterDocRetrieveBindingSoap11</con:interface><con:operation>RespondingGateway_CrossGatewayRetrieve</con:operation><con:request name="Adapter_CrossGatewayRetrieve"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://dodadapter.fedsconnect.org:9080/NhinConnect/AdapterDocRetrieve</con:endpoint><con:request><![CDATA[<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
   <SOAP-ENV:Header/>
   <SOAP-ENV:Body>
      <ns1:RespondingGateway_CrossGatewayRetrieveRequest xmlns:msgns="urn:gov:hhs:fha:nhinc:adapterdocretrieve" xmlns:ns1="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter">
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.3.11111</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns0:RetrieveDocumentSetRequest xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="urn:ihe:iti:xds-b:2007" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns13:DocumentRequest>
               <ns13:HomeCommunityId>urn:oid:1.1</ns13:HomeCommunityId>
               <ns13:RepositoryUniqueId>1</ns13:RepositoryUniqueId>
               <ns13:DocumentUniqueId>2.3.22222</ns13:DocumentUniqueId>
            </ns13:DocumentRequest>
         </ns0:RetrieveDocumentSetRequest>
         <ns1:assertion xmlns:S="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns10="http://docs.oasis-open.org/wsn/b-2" xmlns:ns11="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns12="http://nhinc.services.com/schema/auditmessage" xmlns:ns13="urn:ihe:iti:xds-b:2007" xmlns:ns14="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/t-1" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns6="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns7="urn:gov:hhs:fha:nhinc:common:nhinccommoninternalorch" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns9="http://www.w3.org/2005/08/addressing">
            <ns6:dateOfSignature>2009-05-19T21:57:58Z</ns6:dateOfSignature>
            <ns6:expirationDate>2009-06-18T22:02:58Z</ns6:expirationDate>
            <ns6:haveSecondWitnessSignature>false</ns6:haveSecondWitnessSignature>
            <ns6:haveSignature>false</ns6:haveSignature>
            <ns6:haveWitnessSignature>false</ns6:haveWitnessSignature>
            <ns6:userInfo>
               <ns6:personName>
                  <ns6:familyName>FRANKLIN</ns6:familyName>
                  <ns6:givenName>MARK</ns6:givenName>
                  <ns6:secondNameOrInitials>ALAN</ns6:secondNameOrInitials>
               </ns6:personName>
               <ns6:userName>mfranklin</ns6:userName>
               <ns6:org>
                  <ns6:name>InternalTest1</ns6:name>
               </ns6:org>
               <ns6:roleCoded>
                  <ns6:code>80584001</ns6:code>
                  <ns6:codeSystem>2.16.840.1.113883.6.96</ns6:codeSystem>
                  <ns6:codeSystemName>SNOMED_CT</ns6:codeSystemName>
                  <ns6:displayName>Psychiatrist</ns6:displayName>
               </ns6:roleCoded>
            </ns6:userInfo>
            <ns6:authorized>false</ns6:authorized>
            <ns6:purposeOfDisclosureCoded>
               <ns6:code>PSYCHOTHERAPY</ns6:code>
               <ns6:codeSystem>2.16.840.1.113883.3.18.7.1</ns6:codeSystem>
               <ns6:codeSystemName>nhin-purpose</ns6:codeSystemName>
               <ns6:displayName>Use or disclosure of Psychotherapy Notes</ns6:displayName>
            </ns6:purposeOfDisclosureCoded>
            <ns6:claimFormRef>Ref-Clm-123</ns6:claimFormRef>
            <ns6:claimFormRaw>YWVvbGlhbQ==</ns6:claimFormRaw>
         </ns1:assertion>
      </ns1:RespondingGateway_CrossGatewayRetrieveRequest>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
def documentData = holder["//ns5:RetrieveDocumentSetResponse[1]/ns5:DocumentResponse[1]/ns5:Document[1]"]
assert documentData != null</scriptText></con:configuration></con:assertion><con:assertion type="XPath Match"><con:configuration><path>declare namespace ns1='urn:ihe:iti:xds-b:2007';
declare namespace ns2='urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0';
//ns1:RetrieveDocumentSetResponse[1]/ns2:RegistryResponse[1]/@status</path><content>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:requirements/><con:properties/><con:wssContainer/><con:sensitiveInformation/></con:soapui-project>
<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project name="Adapter Mpi Integration Test Suite" resourceRoot="" soapui-version="4.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterMpiPortTypeBinding" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adaptermpi}AdapterMpiPortTypeBinding" soapVersion="1_1" anonymous="optional" definition="file:/C:/projects/nhinc/Current/Product/Production/Common/Interfaces/src/wsdl/AdapterMpi.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint></con:endpoints><con:operation isOneWay="false" action="FindCandidates" name="FindCandidates" bindingOperationName="FindCandidates" type="Request-Response" outputName="FindCandidatesResponse" inputName="FindCandidatesRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call name="Query"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201301UV"/>
            <urn1:processingCode code="T"/>
            <urn1:processingModeCode code="T"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.198"/>
               </urn1:device>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.198"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:queryByParameter>
                  <urn1:queryId root="1.1" extension="23"/>
                  <urn1:statusCode code="new"/>
                  <urn1:responseModalityCode code="R"/>
                  <urn1:responsePriorityCode code="I"/>
                  <urn1:initialQuanityCode code="RD"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value>
                           <urn1:family partType="FAM">Smith</urn1:family>
                           <urn1:given partType="GIV">Joe</urn1:given>
                        </urn1:value>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:addressType>
               <urn2:city>Orlando</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>FL</urn2:state>
               <urn2:streetAddress>?string?</urn2:streetAddress>
               <urn2:zipCode>?string?</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>?string?</urn2:dateOfBirth>
            <urn2:dateOfSignature>10/25/2008 00:00:00</urn2:dateOfSignature>
            <urn2:expirationDate>12/25/2008 00:00:00</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>auth1234.doc</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>false</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>?string?</urn2:description>
               <urn2:homeCommunityId>?string?</urn2:homeCommunityId>
               <urn2:name>Melbourne Medical Group</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>Jones</urn2:familyName>
               <urn2:givenName>Bertha</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:nameType>
               <urn2:secondNameOrInitials>BAJ</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>?string?</urn2:areaCode>
               <urn2:countryCode>?string?</urn2:countryCode>
               <urn2:extension>?string?</urn2:extension>
               <urn2:localNumber>?string?</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>treatment</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:addressType>
               <urn2:city>?string?</urn2:city>
               <urn2:country>?string?</urn2:country>
               <urn2:state>?string?</urn2:state>
               <urn2:streetAddress>?string?</urn2:streetAddress>
               <urn2:zipCode>?string?</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>?string?</urn2:familyName>
               <urn2:givenName>?string?</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:nameType>
               <urn2:secondNameOrInitials>?string?</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>?string?</urn2:areaCode>
               <urn2:countryCode>?string?</urn2:countryCode>
               <urn2:extension>?string?</urn2:extension>
               <urn2:localNumber>?string?</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>?string?</urn2:SSN>
            <!--1 or more repetitions:-->
            <urn2:uniquePatientId>5678</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:addressType>
               <urn2:city>Atlanta</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>GA</urn2:state>
               <urn2:streetAddress>?string?</urn2:streetAddress>
               <urn2:zipCode>?string?</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>Smythe</urn2:familyName>
               <urn2:givenName>Catherine</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:nameType>
               <urn2:secondNameOrInitials>CS</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>?string?</urn2:areaCode>
               <urn2:countryCode>?string?</urn2:countryCode>
               <urn2:extension>?string?</urn2:extension>
               <urn2:localNumber>?string?</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>?string?</urn2:code>
                  <urn2:codeSystem>?string?</urn2:codeSystem>
                  <urn2:codeSystemName>?string?</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>?string?</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>Smith</urn2:familyName>
                  <urn2:givenName>Betty</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>?string?</urn2:code>
                     <urn2:codeSystem>?string?</urn2:codeSystem>
                     <urn2:codeSystemName>?string?</urn2:codeSystemName>
                     <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                     <urn2:displayName>?string?</urn2:displayName>
                     <urn2:originalText>?string?</urn2:originalText>
                     <!--1 or more repetitions:-->
                     <urn2:translation/>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>Lou</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>user1</urn2:userName>
               <urn2:role>nurse</urn2:role>
               <urn2:org>
                  <urn2:description>hospital</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.166.4</urn2:homeCommunityId>
                  <urn2:name>Holmes</urn2:name>
               </urn2:org>
               <!--Optional:-->
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>?string?</urn2:originalText>
                  <!--1 or more repetitions:-->
                  <urn2:translation/>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <!--Optional:-->
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>?string?</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>?string?</urn2:originalText>
               <!--1 or more repetitions:-->
               <urn2:translation/>
            </urn2:purposeOfDisclosureCoded>
            <!--Optional:-->
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <!--Optional:-->
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:adaptermpi/AdapterMpiPortType/FindCandidatesRequest"/></con:call></con:operation></con:interface><con:testSuite name="Adapter Mpi Test Suite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="FindCandidates - Found TestCase" searchProperties="true" id="ec148eba-c0e6-4822-809f-8ee94e084acb"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source/><con:properties><con:property><con:name>sourceConfigFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>SUT.ConfigFileLocation</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Override Mpi"><con:settings/><con:config><script>import java.io.File;  

def sUTConfigFileLocation = context.expand( '${Test Case Properties#SUT.ConfigFileLocation}' )
def sourceConfigFileLocation = context.expand( '${Test Case Properties#sourceConfigFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sUTConfigFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="FindCandidates"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="FindCandidates"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn1:processingCode code="P"/>
            <urn1:processingModeCode code="R"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
               <urn1:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn1:queryByParameter>
                  <urn1:queryId root="2.16.840.1.113883.3.200" extension="12345"/>
                  <urn1:statusCode code="new"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value>
                           <urn1:family partType="FAM">Smith</urn1:family>
                           <urn1:given partType="GIV">Joe</urn1:given>
                        </urn1:value>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:dateOfSignature>20080520</urn2:dateOfSignature>
            <urn2:expirationDate>20090520</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>Federal - SSA</urn2:description>
               <urn2:homeCommunityId>2.16.840.1.113883.3.184</urn2:homeCommunityId>
               <urn2:name>Federal - SSA</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>NEEDED FOR SSA</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>000000008</urn2:SSN>
            <urn2:uniquePatientId>1000000008</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>mfranklin</urn2:userName>
               <urn2:role>Administrator</urn2:role>
               <urn2:org>
                  <urn2:description>Federal - DoD</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.198</urn2:homeCommunityId>
                  <urn2:name>Federal - DoD</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="XPath Match" name="Check Patient Id Root"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@extension</path><content>1234</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Id Extension"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@root</path><content>2.16.840.1.113883.3.200</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Last Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:family[1]/text()</path><content>Smith</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient First Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:given[1]/text()</path><content>Joe</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Sex"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:administrativeGenderCode[1]/@code</path><content>M</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Bday"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:birthTime[1]/@value</path><content>March 1, 1956</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpi/AdapterMpiPortType/FindCandidatesRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="FindCandidates - Not Found TestCase" searchProperties="true" id="b402b7e0-fa53-4855-bf1f-644f7d64a943"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>sourceConfigFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>SUT.ConfigFileLocation</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Override Mpi"><con:settings/><con:config><script>import java.io.File;  

def sUTConfigFileLocation = context.expand( '${Test Case Properties#SUT.ConfigFileLocation}' )
def sourceConfigFileLocation = context.expand( '${Test Case Properties#sourceConfigFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sUTConfigFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="FindCandidates"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="FindCandidates"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn1:processingCode code="P"/>
            <urn1:processingModeCode code="R"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
               <urn1:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn1:queryByParameter>
                  <urn1:queryId root="2.16.840.1.113883.3.200" extension="12345"/>
                  <urn1:statusCode code="new"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value>
                           <urn1:family partType="FAM">Benson</urn1:family>
                           <urn1:given partType="GIV">Betty</urn1:given>
                        </urn1:value>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:dateOfSignature>20080520</urn2:dateOfSignature>
            <urn2:expirationDate>20090520</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>Federal - SSA</urn2:description>
               <urn2:homeCommunityId>2.16.840.1.113883.3.184</urn2:homeCommunityId>
               <urn2:name>Federal - SSA</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>NEEDED FOR SSA</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>000000008</urn2:SSN>
            <urn2:uniquePatientId>1000000008</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>mfranklin</urn2:userName>
               <urn2:role>Administrator</urn2:role>
               <urn2:org>
                  <urn2:description>Federal - DoD</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.198</urn2:homeCommunityId>
                  <urn2:name>Federal - DoD</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Check For Empty Message"><con:configuration><path>declare namespace xsi='http://www.w3.org/2001/XMLSchema-instance';
declare namespace ns11='urn:hl7-org:v3';
//ns11:PRPA_IN201306UV[1]/@xsi:nil</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="FindCandidates - Found TestCase - Reverse Case" searchProperties="true"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source/><con:properties><con:property><con:name>sourceConfigFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>SUT.ConfigFileLocation</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Override Mpi"><con:settings/><con:config><script>import java.io.File;  

def sUTConfigFileLocation = context.expand( '${Test Case Properties#SUT.ConfigFileLocation}' )
def sourceConfigFileLocation = context.expand( '${Test Case Properties#sourceConfigFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sUTConfigFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="FindCandidates"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="FindCandidates"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn1:processingCode code="P"/>
            <urn1:processingModeCode code="R"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
               <urn1:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn1:queryByParameter>
                  <urn1:queryId root="2.16.840.1.113883.3.200" extension="12345"/>
                  <urn1:statusCode code="new"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value>
                           <urn1:family partType="FAM">smitH</urn1:family>
                           <urn1:given partType="GIV">joE</urn1:given>
                        </urn1:value>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:dateOfSignature>20080520</urn2:dateOfSignature>
            <urn2:expirationDate>20090520</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>Federal - SSA</urn2:description>
               <urn2:homeCommunityId>2.16.840.1.113883.3.184</urn2:homeCommunityId>
               <urn2:name>Federal - SSA</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>NEEDED FOR SSA</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>000000008</urn2:SSN>
            <urn2:uniquePatientId>1000000008</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>mfranklin</urn2:userName>
               <urn2:role>Administrator</urn2:role>
               <urn2:org>
                  <urn2:description>Federal - DoD</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.198</urn2:homeCommunityId>
                  <urn2:name>Federal - DoD</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="XPath Match" name="Check Patient Id Root"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@extension</path><content>1234</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Id Extension"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@root</path><content>2.16.840.1.113883.3.200</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Last Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:family[1]/text()</path><content>Smith</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient First Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:given[1]/text()</path><content>Joe</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Sex"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:administrativeGenderCode[1]/@code</path><content>M</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Bday"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:birthTime[1]/@value</path><content>March 1, 1956</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpi/AdapterMpiPortType/FindCandidatesRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="FindCandidates - No Name" searchProperties="true"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source/><con:properties><con:property><con:name>sourceConfigFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>SUT.ConfigFileLocation</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Override Mpi"><con:settings/><con:config><script>import java.io.File;  

def sUTConfigFileLocation = context.expand( '${Test Case Properties#SUT.ConfigFileLocation}' )
def sourceConfigFileLocation = context.expand( '${Test Case Properties#sourceConfigFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sUTConfigFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="FindCandidates"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="FindCandidates"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn1:processingCode code="P"/>
            <urn1:processingModeCode code="R"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
               <urn1:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn1:queryByParameter>
                  <urn1:queryId root="2.16.840.1.113883.3.200" extension="12345"/>
                  <urn1:statusCode code="new"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value nullFlavor="NA"/>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:dateOfSignature>20080520</urn2:dateOfSignature>
            <urn2:expirationDate>20090520</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>Federal - SSA</urn2:description>
               <urn2:homeCommunityId>2.16.840.1.113883.3.184</urn2:homeCommunityId>
               <urn2:name>Federal - SSA</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>NEEDED FOR SSA</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>000000008</urn2:SSN>
            <urn2:uniquePatientId>1000000008</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>mfranklin</urn2:userName>
               <urn2:role>Administrator</urn2:role>
               <urn2:org>
                  <urn2:description>Federal - DoD</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.198</urn2:homeCommunityId>
                  <urn2:name>Federal - DoD</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="XPath Match" name="Check Patient Id Root"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@extension</path><content>1234</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Id Extension"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@root</path><content>2.16.840.1.113883.3.200</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Last Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:family[1]/text()</path><content>Smith</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient First Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:given[1]/text()</path><content>Joe</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Sex"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:administrativeGenderCode[1]/@code</path><content>M</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Bday"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:birthTime[1]/@value</path><content>March 1, 1956</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpi/AdapterMpiPortType/FindCandidatesRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="FindCandidates - LastName Match, FirstName NoMatch" searchProperties="true"><con:settings/><con:testStep type="properties" name="Test Case Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source/><con:properties><con:property><con:name>sourceConfigFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>SUT.ConfigFileLocation</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Override Mpi"><con:settings/><con:config><script>import java.io.File;  

def sUTConfigFileLocation = context.expand( '${Test Case Properties#SUT.ConfigFileLocation}' )
def sourceConfigFileLocation = context.expand( '${Test Case Properties#sourceConfigFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sUTConfigFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="FindCandidates"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="FindCandidates"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:9080/NhinConnect/AdapterMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter" xmlns:urn1="urn:hl7-org:v3" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PIXConsumer_PRPA_IN201305UVRequest>
         <urn1:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn1:id root="1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn1:creationTime value="20090127043800"/>
            <urn1:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn1:processingCode code="P"/>
            <urn1:processingModeCode code="R"/>
            <urn1:acceptAckCode code="AL"/>
            <urn1:receiver typeCode="RCV">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
               <urn1:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn1:receiver>
            <urn1:sender typeCode="SND">
               <urn1:device determinerCode="INSTANCE">
                  <urn1:id root="2.16.840.1.113883.3.200"/>
               </urn1:device>
            </urn1:sender>
            <urn1:controlActProcess moodCode="EVN">
               <urn1:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn1:queryByParameter>
                  <urn1:queryId root="2.16.840.1.113883.3.200" extension="12345"/>
                  <urn1:statusCode code="new"/>
                  <urn1:parameterList>
                     <urn1:livingSubjectName>
                        <urn1:value>
                           <urn1:family partType="FAM">Smith</urn1:family>
                           <urn1:given partType="GIV">Fred</urn1:given>
                        </urn1:value>
                        <urn1:semanticsText>LivingSubject.name</urn1:semanticsText>
                     </urn1:livingSubjectName>
                  </urn1:parameterList>
               </urn1:queryByParameter>
            </urn1:controlActProcess>
         </urn1:PRPA_IN201305UV>
         <urn:assertion>
            <urn2:address>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>BUFFALO</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>12345 EAST COAST WAY</urn2:streetAddress>
               <urn2:zipCode>01010</urn2:zipCode>
            </urn2:address>
            <urn2:dateOfBirth>19800516</urn2:dateOfBirth>
            <urn2:dateOfSignature>20080520</urn2:dateOfSignature>
            <urn2:expirationDate>20090520</urn2:expirationDate>
            <urn2:explanationNonClaimantSignature>NEEDED</urn2:explanationNonClaimantSignature>
            <urn2:haveSecondWitnessSignature>true</urn2:haveSecondWitnessSignature>
            <urn2:haveSignature>true</urn2:haveSignature>
            <urn2:haveWitnessSignature>true</urn2:haveWitnessSignature>
            <urn2:homeCommunity>
               <urn2:description>Federal - SSA</urn2:description>
               <urn2:homeCommunityId>2.16.840.1.113883.3.184</urn2:homeCommunityId>
               <urn2:name>Federal - SSA</urn2:name>
            </urn2:homeCommunity>
            <urn2:personName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>FRED</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>ANDREW</urn2:secondNameOrInitials>
            </urn2:personName>
            <urn2:phoneNumber>
               <urn2:areaCode>703</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>1212</urn2:extension>
               <urn2:localNumber>555</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:phoneNumber>
            <urn2:purposeOfDisclosure>NEEDED FOR SSA</urn2:purposeOfDisclosure>
            <urn2:secondWitnessAddress>
               <urn2:addressType>
                  <urn2:code>W</urn2:code>
               </urn2:addressType>
               <urn2:city>ALBANY</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>NY</urn2:state>
               <urn2:streetAddress>4 TROY STREET</urn2:streetAddress>
               <urn2:zipCode>01033</urn2:zipCode>
            </urn2:secondWitnessAddress>
            <urn2:secondWitnessName>
               <urn2:familyName>JONES</urn2:familyName>
               <urn2:givenName>JAMES</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>G</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>KENNETH</urn2:secondNameOrInitials>
            </urn2:secondWitnessName>
            <urn2:secondWitnessPhone>
               <urn2:areaCode>301</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>0001</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>W</urn2:code>
               </urn2:phoneNumberType>
            </urn2:secondWitnessPhone>
            <urn2:SSN>000000008</urn2:SSN>
            <urn2:uniquePatientId>1000000008</urn2:uniquePatientId>
            <urn2:witnessAddress>
               <urn2:addressType>
                  <urn2:code>H</urn2:code>
               </urn2:addressType>
               <urn2:city>HARTFORD</urn2:city>
               <urn2:country>USA</urn2:country>
               <urn2:state>CT</urn2:state>
               <urn2:streetAddress>10410 MAIN ST.</urn2:streetAddress>
               <urn2:zipCode>05032</urn2:zipCode>
            </urn2:witnessAddress>
            <urn2:witnessName>
               <urn2:familyName>COREY</urn2:familyName>
               <urn2:givenName>AMANDA</urn2:givenName>
               <urn2:nameType>
                  <urn2:code>H</urn2:code>
               </urn2:nameType>
               <urn2:secondNameOrInitials>EVE</urn2:secondNameOrInitials>
            </urn2:witnessName>
            <urn2:witnessPhone>
               <urn2:areaCode>202</urn2:areaCode>
               <urn2:countryCode>1</urn2:countryCode>
               <urn2:extension>555</urn2:extension>
               <urn2:localNumber>1010</urn2:localNumber>
               <urn2:phoneNumberType>
                  <urn2:code>H</urn2:code>
               </urn2:phoneNumberType>
            </urn2:witnessPhone>
            <urn2:userInfo>
               <urn2:personName>
                  <urn2:familyName>FRANKLIN</urn2:familyName>
                  <urn2:givenName>MARK</urn2:givenName>
                  <urn2:nameType>
                     <urn2:code>P</urn2:code>
                  </urn2:nameType>
                  <urn2:secondNameOrInitials>ALAN</urn2:secondNameOrInitials>
               </urn2:personName>
               <urn2:userName>mfranklin</urn2:userName>
               <urn2:role>Administrator</urn2:role>
               <urn2:org>
                  <urn2:description>Federal - DoD</urn2:description>
                  <urn2:homeCommunityId>2.16.840.1.113883.3.198</urn2:homeCommunityId>
                  <urn2:name>Federal - DoD</urn2:name>
               </urn2:org>
               <urn2:roleCoded>
                  <urn2:code>80584001</urn2:code>
                  <urn2:codeSystem>2.16.840.1.113883.6.96</urn2:codeSystem>
                  <urn2:codeSystemName>SNOMED_CT</urn2:codeSystemName>
                  <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
                  <urn2:displayName>Psychiatrist</urn2:displayName>
                  <urn2:originalText>Psychiatrist</urn2:originalText>
               </urn2:roleCoded>
            </urn2:userInfo>
            <urn2:authorized>true</urn2:authorized>
            <urn2:purposeOfDisclosureCoded>
               <urn2:code>PSYCHOTHERAPY</urn2:code>
               <urn2:codeSystem>2.16.840.1.113883.3.18.7.1</urn2:codeSystem>
               <urn2:codeSystemName>nhin-purpose</urn2:codeSystemName>
               <urn2:codeSystemVersion>1.0</urn2:codeSystemVersion>
               <urn2:displayName>Use or disclosure of Psychotherapy Notes</urn2:displayName>
               <urn2:originalText>Psychotherapy Notes</urn2:originalText>
            </urn2:purposeOfDisclosureCoded>
            <urn2:claimFormRef>Ref-Clm-123</urn2:claimFormRef>
            <urn2:claimFormRaw>YWVvbGlhbQ==</urn2:claimFormRaw>
         </urn:assertion>
      </urn:PIXConsumer_PRPA_IN201305UVRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="XPath Match" name="Check Patient Id Root"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@extension</path><content>1234</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Id Extension"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:id[1]/@root</path><content>2.16.840.1.113883.3.200</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Last Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:family[1]/text()</path><content>Smith</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient First Name"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:name[1]/ns4:given[1]/text()</path><content>Joe</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Sex"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:administrativeGenderCode[1]/@code</path><content>M</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Bday"><con:configuration><path>declare namespace ns4='urn:hl7-org:v3';
//ns4:PRPA_IN201306UV[1]/ns4:controlActProcess[1]/ns4:subject[1]/ns4:registrationEvent[1]/ns4:subject1[1]/ns4:patient[1]/ns4:patientPerson[1]/ns4:birthTime[1]/@value</path><content>March 1, 1956</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpi/AdapterMpiPortType/FindCandidatesRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:requirements/><con:properties/><con:wssContainer/></con:soapui-project>
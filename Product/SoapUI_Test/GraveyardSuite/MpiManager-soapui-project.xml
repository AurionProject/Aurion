<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project name="MpiManager" resourceRoot="" soapui-version="4.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.soapui.TestRunnerAction@values-local"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="TestSuite" value="AdapterMpiManagerPortTypeBinding TestSuite"/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Export JUnit Results" value="false"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="TestRunner Path" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Export All" value="false"/>
  <con:entry key="TestCase" value="&lt;all>"/>
  <con:entry key="Print Report" value="false"/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="Username" value=""/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Endpoint" value=""/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="Save Project" value="false"/>
  <con:entry key="Add Settings" value="false"/>
</xml-fragment>]]></con:setting></con:settings><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterMpiManagerPortTypeBinding" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adaptermpimanager}AdapterMpiManagerPortTypeBinding" soapVersion="1_1" anonymous="optional" definition="file:/C:/projects/NHINC/Current/Product/Production/Common/Interfaces/src/wsdl/AdapterMpiManager.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:8080/AdapterMpiManagerService</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:AddPatient" name="AddPatient" bindingOperationName="AddPatient" type="Request-Response" outputName="AddPatientResponse" inputName="AddPatientRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation><con:operation isOneWay="false" action="urn:RemovePatient" name="RemovePatient" bindingOperationName="RemovePatient" type="Request-Response" outputName="RemovePatientResponse" inputName="RemovePatientRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterComponentMpiPortTypeBinding" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adaptercomponentmpi}AdapterComponentMpiPortTypeBinding" soapVersion="1_1" anonymous="optional" definition="file:/C:/projects/nhinc/Current/Product/Production/Common/Interfaces/src/wsdl/AdapterComponentMpi.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:endpoint></con:endpoints><con:operation isOneWay="false" action="FindCandidates" name="FindCandidates" bindingOperationName="FindCandidates" type="Request-Response" outputName="FindCandidatesResponse" inputName="FindCandidatesRequest" receivesAttachments="false" sendsAttachments="false"><con:settings/></con:operation></con:interface><con:testSuite name="AdapterMpiManagerPortTypeBinding TestSuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="AddPatient TestCase" searchProperties="true" id="1b3f8dc7-19bc-4514-a66b-3fbbb515ecdf"><con:settings/><con:testStep type="properties" name="Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/default.properties</con:source><con:properties><con:property><con:name>SUT.PatientCorrelation</con:name><con:value>http://localhost:9080/PatientCorrelationService</con:value></con:property><con:property><con:name>SUT.PatientCorrelationFacade</con:name><con:value>http://localhost:9080/PatientCorrelationFacadeService</con:value></con:property><con:property><con:name>SUT.PatientCorrelationHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>SUT.PatientCorrelationPort</con:name><con:value>3306</con:value></con:property><con:property><con:name>SUT.PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>SUT.PatientCorrelationUser</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>SUT.PatientCorrelationPass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>SUT.PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Table</con:name><con:value>aa_to_home_community_mapping</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Host</con:name><con:value>localhost</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Port</con:name><con:value>3306</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.DB</con:name><con:value>assigningauthoritydb</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.User</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Pass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>SUT.EntityEndpoint</con:name><con:value>http://localhost:9080/EntityServiceService/EntityServicePort</con:value></con:property><con:property><con:name>SUT.RemoteMPI</con:name><con:value>//dvanhie2.fedsconnect.org/glassfish/domains/domain1/config/mpi.xml</con:value></con:property><con:property><con:name>SUT.LocalMPI</con:name><con:value>//mhsnhie2.fedsconnect.org/glassfish/domains/domain1/config/mpi.xml</con:value></con:property><con:property><con:name>SUT.EntityDocQueryEndpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntityDocQuery</con:value></con:property><con:property><con:name>SUT.EntityDocRetrieveEndpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntityDocRetrieve</con:value></con:property><con:property><con:name>SUT.ConnectionManager.endpoint</con:name><con:value>http://localhost:8080/NhinConnect/NhincComponentConnectionManager</con:value></con:property><con:property><con:name>SUT.PolicyEngine.PolicyEngineFacadeDte.EndpointUrl</con:name><con:value>http://localhost:8080/NhincComponentInternalPolicyEngineTransformService/PolicyEngineTransformationService</con:value></con:property><con:property><con:name>SUT.SubjectDiscovery.Entity.Endpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntitySubjectDiscovery</con:value></con:property><con:property><con:name>SUT.SubjectDiscovery.NhincProxy.Endpoint</con:name><con:value>http://localhost:9080/NhinConnect/NhincProxySubjectDiscovery</con:value></con:property><con:property><con:name>ConfigurationFilesSourceDirectory</con:name><con:value>C:/projects/nhinc/Current/Product/IntegrationTest/GatewayConfigFiles</con:value></con:property><con:property><con:name>GatewayConfigurationDirectory</con:name><con:value>C:/GlassFishESB/glassfish/domains/domain1/config/nhinc</con:value></con:property><con:property><con:name>GlassfishConfigurationDirectory</con:name><con:value>C:/GlassFishESB/glassfish/domains/domain1/config</con:value></con:property><con:property><con:name>SUT.Mpi.MpiManager.Endpoint</con:name><con:value>http://localhost:8080/AdapterMpiManagerService</con:value></con:property><con:property><con:name>SUT.Mpi.Mpi.Endpoint</con:name><con:value>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Save Existing MPI"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml";
String destFileName ="mpi.xml.orig";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sourceConfigFileLocation;

FileUtils.MoveFile (sourceDirectory, sourceFileName, destinationDirectory, destFileName, context, log);</script></con:config></con:testStep><con:testStep type="groovy" name="Delete Mpi"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml";
String sourceDirectory = sourceConfigFileLocation;

FileUtils.DeleteFile (sourceDirectory, sourceFileName, context, log);</script></con:config></con:testStep><con:testStep type="transfer" name="Set Endpoints"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>MpiManagerURL</con:name><con:sourceType>SUT.Mpi.MpiManager.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>AddPatient</con:targetStep></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>MpiURL</con:name><con:sourceType>SUT.Mpi.Mpi.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>MPI Query</con:targetStep></con:transfers></con:config></con:testStep><con:testStep type="request" name="AddPatient"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiManagerPortTypeBinding</con:interface><con:operation>AddPatient</con:operation><con:request name="AddPatient"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/AdapterMpiManagerService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PRPA_IN201301UV ITSVersion="XML_1.0" xmlns="http://xml.netbeans.org/schema/phone" xmlns:msgns="http://j2ee.netbeans.org/wsdl/DataTransformation" xmlns:urn0="http://xml.netbeans.org/schema/homeCommunity" xmlns:urn1="http://xml.netbeans.org/schema/qualifiedSubjectId" xmlns:urn2="http://xml.netbeans.org/schema/subjectDiscoveryInfo" xmlns:urn3="http://xml.netbeans.org/schema/personName" xmlns:urn4="http://xml.netbeans.org/schema/address" xmlns:urn5="http://xml.netbeans.org/schema/documentInfo" xmlns:urn6="urn:ihe:iti:xds-b:2007" xmlns:urn7="http://xml.netbeans.org/schema/document" xmlns:urn8="http://xml.netbeans.org/schema/dataTransform" xmlns:urn9="urn:gov:hhs:fha:nhinc:xsd:documentregistryinfo" xmlns:ns2="http://xml.netbeans.org/schema/ce" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns7="http://xml.netbeans.org/schema/response" xmlns:ns9="http://xml.netbeans.org/schema/realDocumentEntry">
         <urn:id extension="-5a3e95b1:11d1fa33d45:-7f9b" root="1.1.1"/>
         <urn:creationTime value="20080627043800"/>
         <urn:interactionId extension="PRPA_IN201301UV" root="2.16.840.1.113883.1.6"/>
         <urn:processingCode code="T"/>
         <urn:processingModeCode code="T"/>
         <urn:acceptAckCode code="AL"/>
         <urn:receiver typeCode="RCV">
            <urn:device determinerCode="INSTANCE">
               <urn:id root="1.1"/>
            </urn:device>
         </urn:receiver>
         <urn:sender typeCode="SND">
            <urn:device determinerCode="INSTANCE">
               <urn:id root="1.1"/>
            </urn:device>
         </urn:sender>
         <urn:controlActProcess moodCode="EVN">
            <urn:code code="PRPA_TE201301UV"/>
            <urn:informationRecipient typeCode="IRCP">
               <urn:assignedPerson>
                  <urn:representedOrganization>
                     <urn:id root="1.1"/>
                     <urn:name>
                        <urn:delimiter>Integration Community 1</urn:delimiter>
                     </urn:name>
                  </urn:representedOrganization>
               </urn:assignedPerson>
            </urn:informationRecipient>
            <urn:subject contextConductionInd="false" typeCode="SUBJ">
               <urn:registrationEvent classCode="REG" moodCode="EVN">
                  <urn:id nullFlavor="NA"/>
                  <urn:statusCode code="active"/>
                  <urn:subject1>
                     <urn:patient classCode="PAT">
                        <urn:id extension="77777" root="1.1.1"/>
                        <urn:statusCode code="active"/>
                        <urn:patientPerson>
                           <urn:name use="L">
                              <urn:family partType="FAM">Johnson</urn:family>
                              <urn:given partType="GIV">Josephine</urn:given>
                           </urn:name>
                           <urn:telecom use="H" value="321/13/7268546/7452"/>
                           <urn:administrativeGenderCode code="F"/>
                           <urn:birthTime value="20080311"/>
                           <urn:addr use="HME">
                              <urn:country>US</urn:country>
                              <urn:state>FL</urn:state>
                              <urn:city>Orlando</urn:city>
                              <urn:postalCode>98765</urn:postalCode>
                              <urn:streetAddressLine>123 Nixon Rd.</urn:streetAddressLine>
                           </urn:addr>
                           <urn:raceCode code="White"/>
                           <urn:asOtherIDs classCode="PAT">
                              <urn:id extension="987897654" root="2.16.840.1.113883.4.1"/>
                              <urn:scopingOrganization>
                                 <urn:id root="2.16.840.1.113883.4.1"/>
                              </urn:scopingOrganization>
                           </urn:asOtherIDs>
                           <urn:personalRelationship classCode="PRS">
                              <urn:code code="MTH"/>
                              <urn:relationshipHolder1 determinerCode="INSTANCE">
                                 <urn:name use="L">
                                    <urn:family partType="FAM">Jones</urn:family>
                                    <urn:given partType="GIV">Lucy</urn:given>
                                 </urn:name>
                              </urn:relationshipHolder1>
                           </urn:personalRelationship>
                        </urn:patientPerson>
                        <urn:providerOrganization xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                     </urn:patient>
                  </urn:subject1>
                  <urn:custodian xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
               </urn:registrationEvent>
            </urn:subject>
         </urn:controlActProcess>
      </urn:PRPA_IN201301UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:receiver[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:sender[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Ack Message"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:acknowledgement[1]/ns1:acknowledgementDetail[1]/ns1:text[1]/text()</path><content>Patient Successfully added to the MPI</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpimanager/AdapterMpiManagerPortType/AddPatientRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="request" name="MPI Query"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterComponentMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="MPI Query"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
         <urn:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn:id root="1.1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn:creationTime value="20090127043800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn:processingCode code="P"/>
            <urn:processingModeCode code="R"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
               <urn:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess moodCode="EVN">
               <urn:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn:queryByParameter>
                  <urn:queryId root="1.1.1" extension="77777"/>
                  <urn:statusCode code="new"/>
                  <urn:parameterList>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Johnson</urn:family>
                           <urn:given partType="GIV">Josephine</urn:given>
                        </urn:value>
                        <urn:semanticsText>LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance" disabled="true"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Check Patient Id"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@extension</path><content>77777</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Assigning Authority"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@root</path><content>1.1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Lastname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:family[1]/text()</path><content>Johnson</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Firstname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:given[1]/text()</path><content>Josephine</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:receiver[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:sender[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Restore Mpi"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml.orig";
String destFileName ="mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sourceConfigFileLocation;

FileUtils.MoveFile (sourceDirectory, sourceFileName, destinationDirectory, destFileName, context, log);</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="RemovePatient TestCase" searchProperties="true" id="886ce561-a29c-4722-a4b5-235fb63e7b9a"><con:settings/><con:testStep type="properties" name="Properties"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" createMissingOnLoad="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>C:/projects/nhinc/Current/Product/IntegrationTest/default.properties</con:source><con:properties><con:property><con:name>sourceFileLocation</con:name><con:value>C:\Projects\nhinc\Current\Build\Packages\Glassfish\glassfish-ant-deploy\propertyFiles\Integration</con:value></con:property><con:property><con:name>destinationFileLocations</con:name><con:value>C:\GlassFishESB\glassfish\domains\domain1\config</con:value></con:property><con:property><con:name>SUT.PatientCorrelation</con:name><con:value>http://localhost:9080/PatientCorrelationService</con:value></con:property><con:property><con:name>SUT.PatientCorrelationFacade</con:name><con:value>http://localhost:9080/PatientCorrelationFacadeService</con:value></con:property><con:property><con:name>SUT.PatientCorrelationHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>SUT.PatientCorrelationPort</con:name><con:value>3306</con:value></con:property><con:property><con:name>SUT.PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>SUT.PatientCorrelationUser</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>SUT.PatientCorrelationPass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>SUT.PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Table</con:name><con:value>aa_to_home_community_mapping</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Host</con:name><con:value>localhost</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Port</con:name><con:value>3306</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.DB</con:name><con:value>assigningauthoritydb</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.User</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>SUT.AssigningAuthorityMapping.DB.Pass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>SUT.EntityEndpoint</con:name><con:value>http://localhost:9080/EntityServiceService/EntityServicePort</con:value></con:property><con:property><con:name>SUT.RemoteMPI</con:name><con:value>//dvanhie2.fedsconnect.org/glassfish/domains/domain1/config/mpi.xml</con:value></con:property><con:property><con:name>SUT.LocalMPI</con:name><con:value>//mhsnhie2.fedsconnect.org/glassfish/domains/domain1/config/mpi.xml</con:value></con:property><con:property><con:name>SUT.EntityDocQueryEndpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntityDocQuery</con:value></con:property><con:property><con:name>SUT.EntityDocRetrieveEndpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntityDocRetrieve</con:value></con:property><con:property><con:name>SUT.ConnectionManager.endpoint</con:name><con:value>http://localhost:8080/NhinConnect/NhincComponentConnectionManager</con:value></con:property><con:property><con:name>SUT.PolicyEngine.PolicyEngineFacadeDte.EndpointUrl</con:name><con:value>http://localhost:8080/NhincComponentInternalPolicyEngineTransformService/PolicyEngineTransformationService</con:value></con:property><con:property><con:name>SUT.SubjectDiscovery.Entity.Endpoint</con:name><con:value>http://localhost:9080/NhinConnect/EntitySubjectDiscovery</con:value></con:property><con:property><con:name>SUT.SubjectDiscovery.NhincProxy.Endpoint</con:name><con:value>http://localhost:9080/NhinConnect/NhincProxySubjectDiscovery</con:value></con:property><con:property><con:name>SUT.Mpi.MpiManager.Endpoint</con:name><con:value>http://localhost:8080/AdapterMpiManagerService</con:value></con:property><con:property><con:name>SUT.Mpi.Mpi.Endpoint</con:name><con:value>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:value></con:property><con:property><con:name>ConfigurationFilesSourceDirectory</con:name><con:value>C:/projects/nhinc/Current/Product/IntegrationTest/GatewayConfigFiles</con:value></con:property><con:property><con:name>GatewayConfigurationDirectory</con:name><con:value>C:/GlassFishESB/glassfish/domains/domain1/config/nhinc</con:value></con:property><con:property><con:name>GlassfishConfigurationDirectory</con:name><con:value>C:/GlassFishESB/glassfish/domains/domain1/config</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Initial MPI"><con:settings/><con:config><script>import java.io.File;  

def destinationFileLocation = context.expand( '${Properties#destinationFileLocation}' )
def sourceFileLocation = context.expand( '${Properties#sourceFileLocation}' )

String sourceFileName = "mpi_integration_test_mpi.xml";
String sourceDirectory = sourceFileLocation;
String destinationDirectory = destinationFileLocation;

File sourceDir = new File(sourceDirectory);
File sourceFile = new File(sourceDir, sourceFileName);  
File destinationDir = new File(destinationDirectory);
File destinationFile = new File(destinationDir,"mpi.xml");

// Copy test file
log.info("copying mpi from " + sourceFile + " to " + destinationFile);
if(sourceFile.exists())
{
    destinationFile.withWriter 
    { 
        file -> sourceFile.eachLine 
        { 
            line -> file.writeLine(line)  
        }
    }
} 
else {
   log.info("unable to find source file " + sourceFile);
   }</script></con:config></con:testStep><con:testStep type="request" name="RemovePatient"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiManagerPortTypeBinding</con:interface><con:operation>RemovePatient</con:operation><con:request name="RemovePatient"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/AdapterMpiManagerService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns1:PRPA_IN201303UV ITSVersion="XML_1.0" xmlns="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:msgns="urn:ihe:iti:pixv3:2007" xmlns:ns10="http://xml.netbeans.org/schema/qualifiedSubjectId" xmlns:ns11="urn:hl7-org:v3" xmlns:ns12="http://xml.netbeans.org/schema/response" xmlns:ns13="http://xml.netbeans.org/schema/phone" xmlns:ns14="http://xml.netbeans.org/schema/dataTransform" xmlns:ns15="http://xml.netbeans.org/schema/document" xmlns:ns16="http://xml.netbeans.org/schema/subjectDiscoveryInfo" xmlns:ns17="http://xml.netbeans.org/schema/personName" xmlns:ns18="http://xml.netbeans.org/schema/address" xmlns:ns19="urn:ihe:iti:xds-b:2007" xmlns:ns2="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns5="http://xml.netbeans.org/schema/realDocumentEntry" xmlns:ns6="http://xml.netbeans.org/schema/homeCommunity" xmlns:ns7="urn:gov:hhs:fha:nhinc:xsd:documentregistryinfo" xmlns:ns8="http://xml.netbeans.org/schema/ce" xmlns:ns9="http://xml.netbeans.org/schema/documentInfo" xmlns:ns1="urn:hl7-org:v3">
         <ns11:id extension="-2f5e81a1:11db6acf1ec:-7f9e" root="1.1"/>
         <ns11:creationTime value="20080627043800"/>
         <ns11:interactionId extension="PRPA_IN201301UV" root="2.16.840.1.113883.1.6"/>
         <ns11:processingCode code="T"/>
         <ns11:processingModeCode code="T"/>
         <ns11:acceptAckCode code="AL"/>
         <ns11:receiver typeCode="RCV">
            <ns11:device determinerCode="INSTANCE">
               <ns11:id root="2.16.840.1.113883.3.200"/>
            </ns11:device>
         </ns11:receiver>
         <ns11:sender>
            <ns11:device>
               <ns11:id assigningAuthorityName="Federal - DoD" root="2.16.840.1.113883.3.198"/>
            </ns11:device>
         </ns11:sender>
         <ns11:controlActProcess moodCode="EVN">
            <ns11:code code="PRPA_TE201303UV"/>
            <ns11:informationRecipient typeCode="PRCP">
               <ns11:assignedPerson xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            </ns11:informationRecipient>
            <ns11:informationRecipient>
               <ns11:assignedPerson>
                  <ns11:representedOrganization>
                     <ns11:id root="2.16.840.1.113883.3.200"/>
                     <ns11:name>
                        <ns11:delimiter>Federal Agency - VA</ns11:delimiter>
                     </ns11:name>
                  </ns11:representedOrganization>
               </ns11:assignedPerson>
            </ns11:informationRecipient>
            <ns11:subject contextConductionInd="false" typeCode="SUBJ">
               <ns11:registrationEvent classCode="REG" moodCode="EVN">
                  <ns11:id nullFlavor="NA"/>
                  <ns11:statusCode code="active"/>
                  <ns11:subject1>
                     <ns11:patient classCode="PAT">
                        <ns11:id extension="1234" root="2.16.840.1.113883.3.200"/>
                        <ns11:statusCode code="active"/>
                        <ns11:patientPerson>
                           <ns11:name use="L">
                              <ns11:family partType="FAM">Smith</ns11:family>
                              <ns11:given partType="GIV">Joe</ns11:given>
                           </ns11:name>
                           <ns11:administrativeGenderCode code="F"/>
                           <ns11:birthTime value="19760613"/>
                        </ns11:patientPerson>
                     </ns11:patient>
                  </ns11:subject1>
                  <ns11:custodian xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
               </ns11:registrationEvent>
            </ns11:subject>
         </ns11:controlActProcess>
      </ns1:PRPA_IN201303UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpimanager/AdapterMpiManagerPortType/RemovePatientRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Save Existing MPI"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml";
String destFileName ="mpi.xml.orig";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sourceConfigFileLocation;

FileUtils.MoveFile (sourceDirectory, sourceFileName, destinationDirectory, destFileName, context, log);</script></con:config></con:testStep><con:testStep type="groovy" name="Delete Mpi"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml";
String sourceDirectory = sourceConfigFileLocation;

FileUtils.DeleteFile (sourceDirectory, sourceFileName, context, log);</script></con:config></con:testStep><con:testStep type="transfer" name="Set Endpoints"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>MpiAddURL</con:name><con:sourceType>SUT.Mpi.Mpi.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Verify Patient Was Added</con:targetStep></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>MpiManagerAddURL</con:name><con:sourceType>SUT.Mpi.MpiManager.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>AddPatient</con:targetStep></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" entitize="false"><con:name>MpiManagerRemoveURL</con:name><con:sourceType>SUT.Mpi.MpiManager.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Remove Patient</con:targetStep></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true"><con:name>MpiRemoveURL</con:name><con:sourceType>SUT.Mpi.Mpi.Endpoint</con:sourceType><con:sourceStep>Properties</con:sourceStep><con:targetType>Endpoint</con:targetType><con:targetStep>Verify Patient Was Removed</con:targetStep></con:transfers></con:config></con:testStep><con:testStep type="request" name="AddPatient"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiManagerPortTypeBinding</con:interface><con:operation>AddPatient</con:operation><con:request name="AddPatient"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/AdapterMpiManagerService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
      <urn:PRPA_IN201301UV ITSVersion="XML_1.0" xmlns="http://xml.netbeans.org/schema/phone" xmlns:msgns="http://j2ee.netbeans.org/wsdl/DataTransformation" xmlns:urn0="http://xml.netbeans.org/schema/homeCommunity" xmlns:urn1="http://xml.netbeans.org/schema/qualifiedSubjectId" xmlns:urn2="http://xml.netbeans.org/schema/subjectDiscoveryInfo" xmlns:urn3="http://xml.netbeans.org/schema/personName" xmlns:urn4="http://xml.netbeans.org/schema/address" xmlns:urn5="http://xml.netbeans.org/schema/documentInfo" xmlns:urn6="urn:ihe:iti:xds-b:2007" xmlns:urn7="http://xml.netbeans.org/schema/document" xmlns:urn8="http://xml.netbeans.org/schema/dataTransform" xmlns:urn9="urn:gov:hhs:fha:nhinc:xsd:documentregistryinfo" xmlns:ns2="http://xml.netbeans.org/schema/ce" xmlns:ns3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns7="http://xml.netbeans.org/schema/response" xmlns:ns9="http://xml.netbeans.org/schema/realDocumentEntry">
         <urn:id extension="-5a3e95b1:11d1fa33d45:-7f9b" root="1.1.1"/>
         <urn:creationTime value="20080627043800"/>
         <urn:interactionId extension="PRPA_IN201301UV" root="2.16.840.1.113883.1.6"/>
         <urn:processingCode code="T"/>
         <urn:processingModeCode code="T"/>
         <urn:acceptAckCode code="AL"/>
         <urn:receiver typeCode="RCV">
            <urn:device determinerCode="INSTANCE">
               <urn:id root="1.1"/>
            </urn:device>
         </urn:receiver>
         <urn:sender typeCode="SND">
            <urn:device determinerCode="INSTANCE">
               <urn:id root="1.1"/>
            </urn:device>
         </urn:sender>
         <urn:controlActProcess moodCode="EVN">
            <urn:code code="PRPA_TE201301UV"/>
            <urn:informationRecipient typeCode="IRCP">
               <urn:assignedPerson>
                  <urn:representedOrganization>
                     <urn:id root="1.1"/>
                     <urn:name>
                        <urn:delimiter>Integration Community 1</urn:delimiter>
                     </urn:name>
                  </urn:representedOrganization>
               </urn:assignedPerson>
            </urn:informationRecipient>
            <urn:subject contextConductionInd="false" typeCode="SUBJ">
               <urn:registrationEvent classCode="REG" moodCode="EVN">
                  <urn:id nullFlavor="NA"/>
                  <urn:statusCode code="active"/>
                  <urn:subject1>
                     <urn:patient classCode="PAT">
                        <urn:id extension="77777" root="1.1.1"/>
                        <urn:statusCode code="active"/>
                        <urn:patientPerson>
                           <urn:name use="L">
                              <urn:family partType="FAM">Johnson</urn:family>
                              <urn:given partType="GIV">Josephine</urn:given>
                           </urn:name>
                           <urn:telecom use="H" value="321/13/7268546/7452"/>
                           <urn:administrativeGenderCode code="F"/>
                           <urn:birthTime value="20080311"/>
                           <urn:addr use="HME">
                              <urn:country>US</urn:country>
                              <urn:state>FL</urn:state>
                              <urn:city>Orlando</urn:city>
                              <urn:postalCode>98765</urn:postalCode>
                              <urn:streetAddressLine>123 Nixon Rd.</urn:streetAddressLine>
                           </urn:addr>
                           <urn:raceCode code="White"/>
                           <urn:asOtherIDs classCode="PAT">
                              <urn:id extension="987897654" root="2.16.840.1.113883.4.1"/>
                              <urn:scopingOrganization>
                                 <urn:id root="2.16.840.1.113883.4.1"/>
                              </urn:scopingOrganization>
                           </urn:asOtherIDs>
                           <urn:personalRelationship classCode="PRS">
                              <urn:code code="MTH"/>
                              <urn:relationshipHolder1 determinerCode="INSTANCE">
                                 <urn:name use="L">
                                    <urn:family partType="FAM">Jones</urn:family>
                                    <urn:given partType="GIV">Lucy</urn:given>
                                 </urn:name>
                              </urn:relationshipHolder1>
                           </urn:personalRelationship>
                        </urn:patientPerson>
                        <urn:providerOrganization xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                     </urn:patient>
                  </urn:subject1>
                  <urn:custodian xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
               </urn:registrationEvent>
            </urn:subject>
         </urn:controlActProcess>
      </urn:PRPA_IN201301UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:receiver[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:sender[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Ack Message"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:acknowledgement[1]/ns1:acknowledgementDetail[1]/ns1:text[1]/text()</path><content>Patient Successfully added to the MPI</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:adaptermpimanager/AdapterMpiManagerPortType/AddPatientRequest" mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="request" name="Verify Patient Was Added"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterComponentMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="Verify Patient Was Added"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
         <urn:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn:id root="1.1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn:creationTime value="20090127043800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn:processingCode code="P"/>
            <urn:processingModeCode code="R"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
               <urn:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess moodCode="EVN">
               <urn:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn:queryByParameter>
                  <urn:queryId root="1.1.1" extension="77777"/>
                  <urn:statusCode code="new"/>
                  <urn:parameterList>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Johnson</urn:family>
                           <urn:given partType="GIV">Josephine</urn:given>
                        </urn:value>
                        <urn:semanticsText>LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance" disabled="true"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Check Patient Id"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@extension</path><content>77777</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Assigning Authority"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@root</path><content>1.1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Lastname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:family[1]/text()</path><content>Johnson</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Firstname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:given[1]/text()</path><content>Josephine</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:receiver[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:sender[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="request" name="Remove Patient"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterMpiManagerPortTypeBinding</con:interface><con:operation>RemovePatient</con:operation><con:request name="Remove Patient"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/AdapterMpiManagerService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
         <urn:PRPA_IN201303UV ITSVersion="XML_1.0">
            <urn:id extension="-2f5e81a1:11db6acf1ec:-7f9e" root="1.1.1"/>
            <urn:creationTime value="20080627043800"/>
            <urn:interactionId extension="PRPA_IN201303UV" root="2.16.840.1.113883.1.6"/>
            <urn:processingCode code="T"/>
            <urn:processingModeCode code="T"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
            </urn:receiver>
            <urn:sender>
               <urn:device>
                  <urn:id root="1.1"/>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess moodCode="EVN">
               <urn:code code="PRPA_TE201303UV"/>
               <urn:informationRecipient typeCode="PRCP">
                  <urn:assignedPerson xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
               </urn:informationRecipient>
               <urn:informationRecipient>
                  <urn:assignedPerson>
                     <urn:representedOrganization>
                        <urn:id root="1.1"/>
                        <urn:name>
                           <urn:delimiter>Federal Agency - VA</urn:delimiter>
                        </urn:name>
                     </urn:representedOrganization>
                  </urn:assignedPerson>
               </urn:informationRecipient>
               <urn:subject contextConductionInd="false" typeCode="SUBJ">
                  <urn:registrationEvent classCode="REG" moodCode="EVN">
                     <urn:id nullFlavor="NA"/>
                     <urn:statusCode code="active"/>
                     <urn:subject1>
                        <urn:patient classCode="PAT">
                           <urn:id extension="77777" root="1.1.1"/>
                           <urn:statusCode code="active"/>
                           <urn:patientPerson>
                              <urn:name use="L">
                                 <urn:family partType="FAM">Johnson</urn:family>
                                 <urn:given partType="GIV">Josephine</urn:given>
                              </urn:name>
                              <urn:administrativeGenderCode code="F"/>
                              <urn:birthTime value="19760613"/>
                           </urn:patientPerson>
                        </urn:patient>
                     </urn:subject1>
                     <urn:custodian xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                  </urn:registrationEvent>
               </urn:subject>
            </urn:controlActProcess>
         </urn:PRPA_IN201303UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:receiver[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:sender[1]/ns1:device[1]/ns1:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Ack Message"><con:configuration><path>declare namespace ns1='urn:hl7-org:v3';
//ns1:MCCI_IN000002UV01[1]/ns1:acknowledgement[1]/ns1:acknowledgementDetail[1]/ns1:text[1]/text()</path><content>Successfully revoked patient</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="request" name="Verify Patient Was Removed" disabled="true"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterComponentMpiPortTypeBinding</con:interface><con:operation>FindCandidates</con:operation><con:request name="Verify Patient Was Removed"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/NhinConnect/AdapterComponentMpiService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:hl7-org:v3">
   <soapenv:Header/>
   <soapenv:Body>
         <urn:PRPA_IN201305UV ITSVersion="XML_1.0">
            <urn:id root="1.1.1" extension="-705c0da3:11e3fe4d86b:-7bbb"/>
            <urn:creationTime value="20090127043800"/>
            <urn:interactionId root="2.16.840.1.113883.1.6" extension="PRPA_IN201305UV"/>
            <urn:processingCode code="P"/>
            <urn:processingModeCode code="R"/>
            <urn:acceptAckCode code="AL"/>
            <urn:receiver typeCode="RCV">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
               <urn:telecom value="http://localhost:9080/NhinConnect/AdapterMpiService"/>
            </urn:receiver>
            <urn:sender typeCode="SND">
               <urn:device determinerCode="INSTANCE">
                  <urn:id root="1.1"/>
               </urn:device>
            </urn:sender>
            <urn:controlActProcess moodCode="EVN">
               <urn:code code="PRPA_TE201305UV" codeSystem="2.16.840.1.113883.1.6"/>
               <urn:queryByParameter>
                  <urn:queryId root="1.1.1" extension="77777"/>
                  <urn:statusCode code="new"/>
                  <urn:parameterList>
                     <urn:livingSubjectName>
                        <urn:value>
                           <urn:family partType="FAM">Johnson</urn:family>
                           <urn:given partType="GIV">Josephine</urn:given>
                        </urn:value>
                        <urn:semanticsText>LivingSubject.name</urn:semanticsText>
                     </urn:livingSubjectName>
                  </urn:parameterList>
               </urn:queryByParameter>
            </urn:controlActProcess>
         </urn:PRPA_IN201305UV>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance" disabled="true"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Check Patient Id"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@extension</path><content>77777</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Assigning Authority"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:id[1]/@root</path><content>1.1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Lastname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:family[1]/text()</path><content>Johnson</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Patient Firstname"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:controlActProcess[1]/ns3:subject[1]/ns3:registrationEvent[1]/ns3:subject1[1]/ns3:patient[1]/ns3:patientPerson[1]/ns3:name[1]/ns3:given[1]/text()</path><content>Josephine</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Receiver"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:receiver[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Check Sender"><con:configuration><path>declare namespace ns3='urn:hl7-org:v3';
//ns3:PRPA_IN201306UV[1]/ns3:sender[1]/ns3:device[1]/ns3:id[1]/@root</path><content>1.1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Restore Mpi"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def dataSource = testRunner.testCase.getTestStepByName( "Properties" );
def sourceConfigFileLocation = dataSource.getPropertyValue ("GlassfishConfigurationDirectory");

String sourceFileName = "mpi.xml.orig";
String destFileName ="mpi.xml";
String sourceDirectory = sourceConfigFileLocation;
String destinationDirectory = sourceConfigFileLocation;

FileUtils.MoveFile (sourceDirectory, sourceFileName, destinationDirectory, destFileName, context, log);</script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:requirements/><con:properties/><con:wssContainer/></con:soapui-project>
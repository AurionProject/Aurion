<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project name="HIEMConformanceTests" resourceRoot="" soapui-version="4.0.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.soapui.TestRunnerAction@values-local"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="Global Properties" value=""/>
  <con:entry key="TestSuite" value="InternalSelfTest TestSuite"/>
  <con:entry key="Report to Generate" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="soapui-setings.xml Password" value=""/>
  <con:entry key="TestRunner Path" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Ignore Errors" value="false"/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="Save Project" value="false"/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="System Properties" value=""/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Export JUnit Results" value="false"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="Project Properties" value=""/>
  <con:entry key="Project Password" value=""/>
  <con:entry key="Export All" value="false"/>
  <con:entry key="Report Format(s)" value=""/>
  <con:entry key="TestCase" value="&lt;all>"/>
  <con:entry key="Print Report" value="false"/>
  <con:entry key="Username" value=""/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Save After" value="false"/>
  <con:entry key="Add Settings" value="false"/>
  <con:entry key="Endpoint" value=""/>
</xml-fragment>]]></con:setting></con:settings><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="NhincProxySubscriptionManagerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement}NhincProxySubscriptionManagerBindingSoap" soapVersion="1_2" anonymous="optional" definition="C:/Projects/NHINC/Current/Product/Production/Common/Interfaces/src/wsdl/NhincProxySubscriptionManagement.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint><con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint><con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/NhincProxySubscriptionManager</con:endpoint><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxySubscriptionManager</con:endpoint><con:endpoint>http://dvanhie3.fedsconnect.org:8080/NhinConnect/NhincProxySubscriptionManager</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Unsubscribe" name="Unsubscribe" bindingOperationName="Unsubscribe" type="Request-Response" outputName="UnsubscribeResponse" inputName="UnsubscribeRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="NhincProxyNotificationConsumerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxynotificationconsumer}NhincProxyNotificationConsumerBindingSoap" soapVersion="1_2" anonymous="optional" definition="C:/Projects/NHINC/Current/Product/Production/Common/Interfaces/src/wsdl/NhincProxyNotificationConsumer.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyNotificationConsumer</con:endpoint><con:endpoint>http://192.168.25.157:9080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint><con:endpoint>http://ATHC-GFAS:8080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint><con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationConsumer</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Notify" name="Notify" bindingOperationName="Notify" type="One-Way" inputName="NotifyRequest" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="NhincProxyNotificationProducerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement}NhincProxyNotificationProducerBindingSoap" soapVersion="1_2" anonymous="optional" definition="C:/Projects/NHINC/Current/Product/Production/Common/Interfaces/src/wsdl/NhincProxySubscriptionManagement.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://192.168.25.157:8080/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://mhsnhie3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://DVANHIE3.fedsconnect.org:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://ATHC-GFAS:9080/NhinConnect/NhincProxyNotificationProducer</con:endpoint><con:endpoint>http://dvanhie3.fedsconnect.org:8080/NhinConnect/NhincProxySubscriptionManager</con:endpoint><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/NhincProxySubscriptionManager</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Subscribe" name="Subscribe" bindingOperationName="Subscribe" type="Request-Response" outputName="SubscribeResponse" inputName="SubscribeRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="EntitySubscriptionManagerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntitySubscriptionManagerBindingSoap" soapVersion="1_2" anonymous="optional" definition="http://localhost:8080/CONNECTAdapter/EntityNotificationProducer?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntitySubscriptionManager</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Unsubscribe" name="Unsubscribe" bindingOperationName="Unsubscribe" type="Request-Response" outputName="UnsubscribeResponse" inputName="UnsubscribeRequest" receivesAttachments="false" sendsAttachments="false"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="EntityNotificationProducerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement}EntityNotificationProducerBindingSoap" soapVersion="1_2" anonymous="optional" definition="http://localhost:8080/CONNECTAdapter/EntityNotificationProducer?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:8080/CONNECTAdapter/EntityNotificationProducer</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Subscribe" name="Subscribe" bindingOperationName="Subscribe" type="Request-Response" outputName="SubscribeResponse" inputName="SubscribeRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation><con:operation isOneWay="false" action="urn:SubscribeCdcBioPackage" name="SubscribeCdcBioPackage" bindingOperationName="SubscribeCdcBioPackage" type="Request-Response" outputName="SubscribeCdcBioPackageResponse" inputName="SubscribeCdcBioPackageRequest" receivesAttachments="false" sendsAttachments="false"><con:settings/></con:operation><con:operation isOneWay="false" action="urn:SubscribeDocument" name="SubscribeDocument" bindingOperationName="SubscribeDocument" type="Request-Response" outputName="SubscribeDocumentResponse" inputName="SubscribeDocumentRequest" receivesAttachments="false" sendsAttachments="false"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="NotificationConsumerBinding" type="wsdl" bindingName="{http://docs.oasis-open.org/wsn/bw-2}NotificationConsumerBinding" soapVersion="1_2" anonymous="optional" definition="https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>https://localhost:${HttpsDefaultPort}/NotificationProducerService/NotificationConsumerPort</con:endpoint></con:endpoints><con:operation isOneWay="false" action="http://docs.oasis-open.org/wsn/bw-2/NotificationConsumer/Notify" name="Notify" bindingOperationName="Notify" type="One-Way" inputName="" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="NotificationProducerBinding" type="wsdl" bindingName="{http://docs.oasis-open.org/wsn/bw-2}NotificationProducerBinding" soapVersion="1_2" anonymous="optional" definition="https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/NotificationProducerService/HiemSubscription</con:endpoint><con:endpoint>https://localhost:${HttpsDefaultPort}/NotificationProducerService/NotificationProducerPort</con:endpoint></con:endpoints><con:operation isOneWay="false" action="http://docs.oasis-open.org/wsn/bw-2/NotificationProducer/SubscribeRequest" name="Subscribe" bindingOperationName="Subscribe" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="SubscriptionManagerBinding" type="wsdl" bindingName="{http://docs.oasis-open.org/wsn/bw-2}SubscriptionManagerBinding" soapVersion="1_2" anonymous="optional" definition="https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>https://localhost:${HttpsDefaultPort}/SubscriptionManagerService/SubscriptionManagerPort</con:endpoint><con:endpoint>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:endpoint></con:endpoints><con:operation isOneWay="false" action="http://docs.oasis-open.org/wsn/bw-2/SubscriptionManager/UnsubscribeRequest" name="Unsubscribe" bindingOperationName="Unsubscribe" type="Request-Response" outputName="UnsubscribeResponse" inputName="UnsubscribeRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="EntityNotificationConsumerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:entitynotificationconsumer}EntityNotificationConsumerBindingSoap" soapVersion="1_2" anonymous="optional" definition="file:/C:/projects/nhinc/Current/Product/Production/Common/Interfaces/src/wsdl/EntityNotificationConsumer.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    
    <con:endpoints>
      <con:endpoint>http://MHSNHIE3.fedsconnect.org:8080/NhinConnect/EntityNotificationConsumer</con:endpoint>
      <con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/EntityNotificationConsumer</con:endpoint>
    </con:endpoints>
    <con:operation isOneWay="false" action="urn:NotifySubscribersOfCdcBioPackage" name="NotifySubscribersOfCdcBioPackage" bindingOperationName="NotifySubscribersOfCdcBioPackage" type="Request-Response" outputName="NotifySubscribersOfCdcBioPackageResponse" inputName="NotifySubscribersOfCdcBioPackageRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional">
      <con:settings/>
    </con:operation>
    <con:operation isOneWay="false" action="urn:NotifySubscribersOfDocument" name="NotifySubscribersOfDocument" bindingOperationName="NotifySubscribersOfDocument" type="Request-Response" outputName="NotifySubscribersOfDocumentResponse" inputName="NotifySubscribersOfDocumentRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional">
      <con:settings/>
    </con:operation>
    <con:operation isOneWay="false" action="urn:Notify" name="Notify" bindingOperationName="Notify" type="Request-Response" outputName="NotifyResponse" inputName="NotifyRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional">
      <con:settings/>
    </con:operation>
  </con:interface><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="AdapterNotificationConsumerBindingSoap" type="wsdl" bindingName="{urn:gov:hhs:fha:nhinc:adapternotificationconsumer}AdapterNotificationConsumerBindingSoap" soapVersion="1_2" anonymous="optional" definition="file:/C:/NHINC/Interfaces/wsdl/AdapterNotificationConsumer.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:endpoints><con:endpoint>http://localhost:${HttpDefaultPort}/NhinConnect/AdapterNotificationConsumer</con:endpoint></con:endpoints><con:operation isOneWay="false" action="urn:Notify" name="Notify" bindingOperationName="Notify" type="Request-Response" outputName="NotifyResponse" inputName="NotifyRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation><con:operation isOneWay="false" action="urn:NotifySubscribersOfCdcBioPackage" name="NotifySubscribersOfCdcBioPackage" bindingOperationName="NotifySubscribersOfCdcBioPackage" type="Request-Response" outputName="NotifySubscribersOfCdcBioPackageResponse" inputName="NotifySubscribersOfCdcBioPackageRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation><con:operation isOneWay="false" action="urn:NotifySubscribersOfDocument" name="NotifySubscribersOfDocument" bindingOperationName="NotifySubscribersOfDocument" type="Request-Response" outputName="NotifySubscribersOfDocumentResponse" inputName="NotifySubscribersOfDocumentRequest" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/></con:operation></con:interface><con:testSuite name="HIEMConformanceTests"><con:description/><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMI-1.1-initiate: subscribe" searchProperties="true" id="303c252a-eed0-496c-b0c6-38733e85dcbb">
      <con:settings/>
      
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config>
          <script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Modify Subscribe Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockPort = context.findProperty("mockPort");
def mockSubscribeURL = "https://" + mockHost + ":" + mockPort + "/mockSubscribe";
def RemoteHCID = context.findProperty( "RemoteHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, RemoteHCID, "notificationproducer", mockSubscribeURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="request" name="Subscribe">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityNotificationProducerBindingSoap</con:interface>
          <con:operation>Subscribe</con:operation>
          <con:request name="Subscribe" outgoingWss="" incomingWss="" wssPasswordType="">
            <con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>${#Project#Endpoint-EntitySubscribe}</con:endpoint>
            <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMI-1.1-initiate: subscribe">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#Topic}</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
            <con:assertion type="SOAP Response"/>
            <con:assertion type="SOAP Fault Assertion"/>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep><con:testStep type="mockresponse" name="Subscribe Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Subscribe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NotificationProducerBinding</con:interface><con:operation>Subscribe</con:operation><con:path>/mockSubscribe</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<S:Envelope xmlns:S="http://www.w3.org/2003/05/soap-envelope" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:wsse11="http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd">
   <S:Header>
      <To xmlns="http://www.w3.org/2005/08/addressing">http://www.w3.org/2005/08/addressing/anonymous</To>
      <Action xmlns="http://www.w3.org/2005/08/addressing">http://docs.oasis-open.org/wsn/bw-2/NotificationProducer/SubscribeResponse</Action>
      <MessageID xmlns="http://www.w3.org/2005/08/addressing">uuid:aa00c0df-380d-4157-9258-fe188392aa05</MessageID>
      <RelatesTo xmlns="http://www.w3.org/2005/08/addressing">uuid:ffbf21da-0545-487a-8c57-4215b4930e11</RelatesTo>
   </S:Header>
   <S:Body>
      <ns3:SubscribeResponse xmlns="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns2="http://www.w3.org/2005/08/addressing" xmlns:ns3="http://docs.oasis-open.org/wsn/b-2" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns6="http://www.hhs.gov/healthit/nhin" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns8="http://docs.oasis-open.org/wsn/t-1" xmlns:ns9="http://docs.oasis-open.org/wsrf/r-2">
         <ns3:SubscriptionReference>
            <ns2:Address>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</ns2:Address>
            <ns2:ReferenceParameters>
               <ns6:SubscriptionId xmlns="http://www.hhs.gov/healthit/nhin">${#Project#RemoteSubID}</ns6:SubscriptionId>
            </ns2:ReferenceParameters>
         </ns3:SubscriptionReference>
         <ns3:TerminationTime xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
      </ns3:SubscribeResponse>
   </S:Body>
</S:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns4='http://docs.oasis-open.org/wsn/b-2';
//ns4:Subscribe[1]/ns4:Filter[1]/ns4:TopicExpression[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep>
      
      <con:testStep type="groovy" name="Count Subscriptions (2)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 2 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:38:59Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMI-1.2-initiate: subscribe unsupported topic" searchProperties="true" id="986ead70-44df-4652-b540-0d0ce6146960">
      <con:settings/>
      
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config>
          <script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="ModifyInterrnalConnectionInfoforSubscribe">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");
def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

//**** mockHost is localhost because Groovy script resides in local machine ****
def mockHost = context.findProperty("mockHost");
def mockPort = context.findProperty("mockPort");
def mockSubscribeURL = "https://" + mockHost + ":" + mockPort + "/mockSubscribe";
def RemoteHCID = context.findProperty( "RemoteHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, RemoteHCID, "notificationproducer", mockSubscribeURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="request" name="Subscribe">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntityNotificationProducerBindingSoap</con:interface>
          <con:operation>Subscribe</con:operation>
          <con:request name="Subscribe" outgoingWss="" incomingWss="" wssPasswordType="">
            <con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>${#Project#Endpoint-EntitySubscribe}</con:endpoint>
            <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMI-1.2-initiate: subscribe unsupported topic">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#Topic}</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>HCDescription</nccommon:description>
               <nccommon:homeCommunityId>HC-1234</nccommon:homeCommunityId>
               <nccommon:name>HCName</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetCommunities>
            <urn1:nhinTargetCommunity>
               <urn1:homeCommunity>
                  <urn1:description>${#Project#RemoteHCDescription}</urn1:description>
                  <urn1:homeCommunityId>${#Project#RemoteHCID}</urn1:homeCommunityId>
                  <urn1:name>${#Project#RemoteHCDescription}</urn1:name>
               </urn1:homeCommunity>
            </urn1:nhinTargetCommunity>
         </urn:nhinTargetCommunities>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
            <con:assertion type="SOAP Response"/>
            <con:assertion type="SOAP Fault Assertion"/>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntityNotificationProducerPortType/SubscribeDocumentRequest"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep><con:testStep type="mockresponse" name="Subscribe Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Subscribe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NotificationProducerBinding</con:interface><con:operation>Subscribe</con:operation><con:path>/mockSubscribe</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<env:Envelope xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsrf-bf="http://docs.oasis-open.org/wsrf/bf-2" xmlns:env="http://www.w3.org/2003/05/soap-envelope">
   <env:Header>
      <To xmlns="http://www.w3.org/2005/08/addressing">http://www.w3.org/2005/08/addressing/anonymous</To>
      <Action xmlns="http://www.w3.org/2005/08/addressing">http://docs.oasis-open.org/wsn/bw-2/NotificationProducer/SubscribeResponse</Action>
      <MessageID xmlns="http://www.w3.org/2005/08/addressing">uuid:aa00c0df-380d-4157-9258-fe188392aa05</MessageID>
      <RelatesTo xmlns="http://www.w3.org/2005/08/addressing">uuid:ffbf21da-0545-487a-8c57-4215b4930e11</RelatesTo>
   </env:Header>
   <env:Body>
      <env:Fault>
         <env:Code>
            <env:Value>env:Sender</env:Value>
         </env:Code>
         <env:Reason>
            <env:Text xml:lang="en">Topic not supported</env:Text>
         </env:Reason>
         <env:Detail>
            <wsnt:TopicNotSupportedFault>
               <wsrf-bf:Timestamp>2005-05-04T20:18:44.970</wsrf-bf:Timestamp>
            </wsnt:TopicNotSupportedFault>
         </env:Detail>
      </env:Fault>
   </env:Body>
</env:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns4='http://docs.oasis-open.org/wsn/b-2';
//ns4:Subscribe[1]/ns4:Filter[1]/ns4:TopicExpression[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep>
      
      <con:testStep type="groovy" name="Count Subscriptions (1)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:39:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMI-2.1-initiate: receive message" searchProperties="true" id="fb758d93-7c1c-4f2d-86ed-4479b188ac0e">
      <con:settings/>
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Notify DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>Notify</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>2</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep><con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Notify DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (2)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 2 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep><con:testStep type="groovy" name="Modify Notify Adapter Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockNotifyURL = "http://" + mockHost + ":11223/mockNotifyAdapter";
def LocalHCID = context.findProperty( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, LocalHCID, "adapternotificationconsumer", mockNotifyURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="properties" name="Payload"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="false" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>${projectDir}/Small_Payload.properties</con:source><con:properties><con:property><con:name>Payload</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep>
      <con:testStep type="request" name="Notify"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NhincProxyNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:request name="Notify"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-NHINCProxyNotify}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMI-2.1-initiate: receive message">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple">${#Project#Topic}</b:Topic>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
                  <wsa:Address>${#Project#NotifySubscriptionManagerEndpointAddress}</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#NotifySubscriptionID}</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
               <b:Message>
                  <payload xmlns:ns10="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:ns11="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns12="urn:ihe:iti:xds-b:2007" xmlns:ns13="http://docs.oasis-open.org/wsn/t-1" xmlns:ns14="http://nhinc.services.com/schema/auditmessage" xmlns:ns17="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns18="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/08/addressing">
                     <payload>${Payload#Payload}</payload>
                  </payload>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:dateOfSignature>${#Project#sigDate}</urn4:dateOfSignature>
            <urn4:expirationDate>${#Project#expireDate}</urn4:expirationDate>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:purposeOfDisclosure>TREATMENT</urn4:purposeOfDisclosure>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:role>Pharmacy</urn4:role>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <urn4:accessConsentPolicy>urn:oid:1.2.3.4</urn4:accessConsentPolicy>
                     <urn4:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" disabled="true"/><con:assertion type="Schema Compliance" disabled="true"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion" disabled="true"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="mockresponse" name="Notify Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Notify" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:path>/mockNotifyAdapter</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:Acknowledgement/>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match" name="NotifySubscriptionManagerEndpointAddress Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:Address[1]</path><content>${#Project#NotifySubscriptionManagerEndpointAddress}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Topic[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Subscription ID Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
declare namespace SubscriptionId='http://www.hhs.gov/healthit/nhin';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]</path><content>${#Project#NotifySubscriptionID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Payload Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Message[1]/payload[1]/payload[1]</path><content>${Payload#Payload}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:39:01Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMI-2.2-initiate: receive large message" searchProperties="true" id="77fd5d73-217c-4f02-a24a-67fcc0376157">
      <con:settings/>
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Notify DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>Notify</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>2</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep><con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Notify DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (2)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 2 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep><con:testStep type="groovy" name="Modify Notify Adapter Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockNotifyURL = "http://" + mockHost + ":11223/mockNotifyAdapter";
def LocalHCID = context.findProperty( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, LocalHCID, "adapternotificationconsumer", mockNotifyURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="properties" name="Payload"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="false" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>${projectDir}/Big_Payload.properties</con:source><con:properties><con:property><con:name>Payload</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep>
      <con:testStep type="request" name="Notify"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NhincProxyNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:request name="Notify"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-NHINCProxyNotify}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMI-2.2-initiate: receive large message">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple">${#Project#Topic}</b:Topic>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
                  <wsa:Address>${#Project#NotifySubscriptionManagerEndpointAddress}</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#NotifySubscriptionID}</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
               <b:Message>
                  <payload xmlns:ns10="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:ns11="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns12="urn:ihe:iti:xds-b:2007" xmlns:ns13="http://docs.oasis-open.org/wsn/t-1" xmlns:ns14="http://nhinc.services.com/schema/auditmessage" xmlns:ns17="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns18="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/08/addressing">
                     <payload>${Payload#Payload}</payload>
                  </payload>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:dateOfSignature>${#Project#sigDate}</urn4:dateOfSignature>
            <urn4:expirationDate>${#Project#expireDate}</urn4:expirationDate>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:purposeOfDisclosure>TREATMENT</urn4:purposeOfDisclosure>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:role>Pharmacy</urn4:role>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <urn4:accessConsentPolicy>urn:oid:1.2.3.4</urn4:accessConsentPolicy>
                     <urn4:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" disabled="true"/><con:assertion type="Schema Compliance" disabled="true"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion" disabled="true"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="mockresponse" name="Notify Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Notify" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:path>/mockNotifyAdapter</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:Acknowledgement/>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match" name="NotifySubscriptionManagerEndpointAddress Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:Address[1]</path><content>${#Project#NotifySubscriptionManagerEndpointAddress}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Topic[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Subscription ID Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
declare namespace SubscriptionId='http://www.hhs.gov/healthit/nhin';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]</path><content>${#Project#NotifySubscriptionID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Payload Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Message[1]/payload[1]/payload[1]</path><content>${Payload#Payload}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:35:20Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMI-3.1-initiate: unsubscribe" searchProperties="true" id="48f810d9-71bc-4dc9-857c-9a72b543f2e7">
      <con:settings/>
      
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>//def destConfigFileLocation = context.findProperty("NHINGatewayConfigDir");


def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Unsubscribe DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>Unsubscribe</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>1</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep>
      <con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep>
      
      <con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Unsubscribe DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (2)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 2 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep>
      <con:testStep type="request" name="Unsubscribe">
        <con:settings/>
        <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:interface>EntitySubscriptionManagerBindingSoap</con:interface>
          <con:operation>Unsubscribe</con:operation>
          <con:request name="Unsubscribe" outgoingWss="" incomingWss="" wssPasswordType="">
            <con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings>
            <con:encoding>UTF-8</con:encoding>
            <con:endpoint>${#Project#Endpoint-EntityUnsubscribe}</con:endpoint>
            <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:nhin="http://www.hhs.gov/healthit/nhin" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header>
      <ns5:SubscriptionId xmlns="http://www.w3.org/2005/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/b-2" xmlns:ns3="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns4="http://docs.oasis-open.org/wsn/t-1" xmlns:ns5="http://www.hhs.gov/healthit/nhin">${#Project#UnSubscriptionID}</ns5:SubscriptionId>
      <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">hello world</nhinconnect:Info>
   </soapenv:Header>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMI-3.1-initiate: unsubscribe">
      <urn:UnsubscribeRequest>
         <wsnt:Unsubscribe xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
            <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">just some data</nhinconnect:Info>
         </wsnt:Unsubscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:dateOfSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#sigDate}</nccommon:dateOfSignature>
            <nccommon:expirationDate xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">${#Project#expireDate}</nccommon:expirationDate>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
               <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
               <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:purposeOfDisclosure xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">TREATMENT</nccommon:purposeOfDisclosure>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:role>Pharmacy</nccommon:role>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>urn:oid:1.2.3.4</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
      </urn:UnsubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
            <con:assertion type="SOAP Response"/>
            <con:assertion type="SOAP Fault Assertion"/>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement/EntitySubscriptionManagerPortType/UnsubscribeRequest"/>
            <con:wsrmConfig version="1.2"/>
          </con:request>
        </con:config>
      </con:testStep><con:testStep type="mockresponse" name="Unsubscribe Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Unsubscribe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>SubscriptionManagerBinding</con:interface><con:operation>Unsubscribe</con:operation><con:path>/mockUnsubscribe</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<S:Envelope xmlns:S="http://www.w3.org/2003/05/soap-envelope" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:wsse11="http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd">
   <S:Header>
      <To xmlns="http://www.w3.org/2005/08/addressing">http://www.w3.org/2005/08/addressing/anonymous</To>
      <Action xmlns="http://www.w3.org/2005/08/addressing">http://docs.oasis-open.org/wsn/bw-2/SubscriptionManager/UnsubscribeResponse</Action>
      <MessageID xmlns="http://www.w3.org/2005/08/addressing">uuid:44c4585d-e549-4343-9571-9dc1ccd20406</MessageID>
      <RelatesTo xmlns="http://www.w3.org/2005/08/addressing">uuid:3617d92c-2c7f-41c2-8d55-ee7cb5593b4c</RelatesTo>
   </S:Header>
   <S:Body>
      <ns3:UnsubscribeResponse xmlns="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns2="http://www.w3.org/2005/08/addressing" xmlns:ns3="http://docs.oasis-open.org/wsn/b-2" xmlns:ns4="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns6="http://www.hhs.gov/healthit/nhin" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns8="http://docs.oasis-open.org/wsn/t-1" xmlns:ns9="http://docs.oasis-open.org/wsrf/r-2"/>
   </S:Body>
</S:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (0)">
        <con:settings/>
        <con:config>
          <script>context.withSql('SubscriptionDB') { sql -> 
  assert 0 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script>
        </con:config>
      </con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:39:08Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-4.1-respond: subscribe" searchProperties="true" id="4fcaa4b6-74b9-48f9-91f4-752680f937b3"><con:settings/><con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table"><con:settings/><con:config><script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

</script></con:config></con:testStep><con:testStep type="request" name="Subscribe"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NhincProxyNotificationProducerBindingSoap</con:interface><con:operation>Subscribe</con:operation><con:request name="Subscribe"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-NHINCProxySubscribe}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-4.1-respond: subscribe">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#Topic}</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
               <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
               <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>Claim-Ref-1234</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>Claim-Instance-1</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Fault Assertion"/><con:assertion type="SOAP Response"/><con:assertion type="GroovyScriptAssertion" name="Subscription ID"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
holder.namespaces["ns3"] = "http://www.w3.org/2005/08/addressing"
holder.namespaces["ns4"] = "http://docs.oasis-open.org/wsn/b-2"
holder.namespaces["ns5"] = "urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc"
assert holder["//ns4:SubscribeResponse[1]/ns4:SubscriptionReference[1]/ns3:ReferenceParameters[1]/ns5:SubscriptionId[1]"] != null

</scriptText></con:configuration></con:assertion><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement/NhincProxyNotificationProducerPortType/SubscribeRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (1)"><con:settings/><con:config><script>import groovy.sql.Sql

context.withSql('SubscriptionDB') { sql -> 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
</script></con:config></con:testStep><con:properties><con:property><con:name>startDate</con:name><con:value>2010-08-30T00:00:00Z</con:value></con:property><con:property><con:name>endDate</con:name><con:value>2010-08-30T04:39:12Z</con:value></con:property><con:property><con:name>sigDate</con:name><con:value>08/30/2010 00:00:00</con:value></con:property><con:property><con:name>expireDate</con:name><con:value>2010-09-29T00:00:00Z</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-4.2-respond: subscribe unsupported topic" searchProperties="true" id="a3378e3a-358a-438b-a202-618d2bd55b58"><con:settings/><con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table"><con:settings/><con:config><script>context.withSql('SubscriptionDB') { sql -> 
  sql.execute('delete from ' + context.findProperty('SubscriptionTable'))
}

</script></con:config></con:testStep><con:testStep type="request" name="Subscribe"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NhincProxyNotificationProducerBindingSoap</con:interface><con:operation>Subscribe</con:operation><con:request name="Subscribe"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-NHINCProxySubscribe}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add1="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-4.2-respond: subscribe unsupported topic">
      <urn:SubscribeRequest>
         <wsnt:Subscribe>
            <wsnt:ConsumerReference>
               <wsa:Address>${#Project#NotificationEndpoint}</wsa:Address>
            </wsnt:ConsumerReference>
            <wsnt:Filter>
               <wsnt:TopicExpression Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple" xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#NonexistentTopic}</wsnt:TopicExpression>
            </wsnt:Filter>
         </wsnt:Subscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
               <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
               <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>Claim-Ref-1234</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>Claim-Instance-1</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn1:homeCommunity>
               <urn1:description>${#Project#LocalHCDescription}</urn1:description>
               <urn1:homeCommunityId>${#Project#LocalHCID}</urn1:homeCommunityId>
               <urn1:name>${#Project#LocalHCDescription}</urn1:name>
            </urn1:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:SubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="GroovyScriptAssertion" name="Subscription ID"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.responseContent )
holder.namespaces["ns3"] = "http://www.w3.org/2005/08/addressing"
holder.namespaces["ns4"] = "http://docs.oasis-open.org/wsn/b-2"
holder.namespaces["ns5"] = "urn:gov:hhs:fha:nhinc:common:subscriptionb2overrideforcdc"
def subscriptionId = holder["//ns4:SubscribeResponse[1]/ns4:SubscriptionReference[1]/ns3:ReferenceParameters[1]/ns5:SubscriptionId[1]"]

assert (subscriptionId.size() == 0)
</scriptText></con:configuration></con:assertion><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:assertion type="Not SOAP Fault Assertion"/><con:assertion type="XPath Match" name="Reason Text Match"><con:configuration><path>declare namespace S='http://www.w3.org/2003/05/soap-envelope';
//S:Text[1]</path><content>${#Project#TopicNotSupportedMessage}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:wsaConfig action="urn:gov:hhs:fha:nhinc:nhincproxysubscriptionmanagement/NhincProxyNotificationProducerPortType/SubscribeRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (0)"><con:settings/><con:config><script>import groovy.sql.Sql

context.withSql('SubscriptionDB') { sql -> 
  assert 0 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
</script></con:config></con:testStep><con:properties><con:property><con:name>startDate</con:name><con:value>2010-08-30T00:00:00Z</con:value></con:property><con:property><con:name>endDate</con:name><con:value>2010-08-30T04:39:13Z</con:value></con:property><con:property><con:name>sigDate</con:name><con:value>08/30/2010 00:00:00</con:value></con:property><con:property><con:name>expireDate</con:name><con:value>2010-09-29T00:00:00Z</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-5.1-respond: send message" searchProperties="true" id="6852383d-c89f-40c7-be71-7adde6f402df">
      <con:settings/>
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Notify DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>Notify</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>1</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep><con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Notify DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (3)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep><con:testStep type="groovy" name="Modify Notify Adapter Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockNotifyURL = "http://" + mockHost + ":11223/mockNotifyAdapter";
def LocalHCID = context.findProperty( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, LocalHCID, "adapternotificationconsumer", mockNotifyURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="properties" name="Payload"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="false" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>${projectDir}/Small_Payload.properties</con:source><con:properties><con:property><con:name>Payload</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep>
      <con:testStep type="request" name="Notify"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EntityNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:request name="Notify"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-EntityNotify}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-5.1-respond: send message">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple">${#Project#Topic}</b:Topic>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
                  <wsa:Address>${#Project#NotifySubscriptionManagerEndpointAddress}</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#NotifySubscriptionID}</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
               <b:Message>
                  <payload xmlns:ns10="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:ns11="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns12="urn:ihe:iti:xds-b:2007" xmlns:ns13="http://docs.oasis-open.org/wsn/t-1" xmlns:ns14="http://nhinc.services.com/schema/auditmessage" xmlns:ns17="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns18="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/08/addressing">
                     <payload>${Payload#Payload}</payload>
                  </payload>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:dateOfSignature>${#Project#sigDate}</urn4:dateOfSignature>
            <urn4:expirationDate>${#Project#expireDate}</urn4:expirationDate>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:purposeOfDisclosure>TREATMENT</urn4:purposeOfDisclosure>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:role>Pharmacy</urn4:role>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <urn4:accessConsentPolicy>urn:oid:1.2.3.4</urn4:accessConsentPolicy>
                     <urn4:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="mockresponse" name="Notify Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Notify" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:path>/mockNotifyAdapter</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:Acknowledgement/>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match" name="NotifySubscriptionManagerEndpointAddress Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:Address[1]</path><content>${#Project#NotifySubscriptionManagerEndpointAddress}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Topic[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Subscription ID Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
declare namespace SubscriptionId='http://www.hhs.gov/healthit/nhin';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]</path><content>${#Project#NotifySubscriptionID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Payload Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Message[1]/payload[1]/payload[1]</path><content>${Payload#Payload}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:39:13Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-5.2-respond: send large message" searchProperties="true" id="527bd6a0-fee9-4e53-824b-20f4d4632d00">
      <con:settings/>
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Notify DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>Notify</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>1</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep><con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Notify DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (3)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 3 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep><con:testStep type="groovy" name="Modify Notify Adapter Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockNotifyURL = "http://" + mockHost + ":11223/mockNotifyAdapter";
def LocalHCID = context.findProperty( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, LocalHCID, "adapternotificationconsumer", mockNotifyURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="properties" name="Payload"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="false" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>${projectDir}/Big_Payload.properties</con:source><con:properties><con:property><con:name>Payload</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep><con:testStep type="request" name="Notify"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EntityNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:request name="Notify"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-EntityNotify}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-5.2-respond: send large message">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple">${#Project#Topic}</b:Topic>
               <b:SubscriptionReference xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
                  <wsa:Address>${#Project#NotifySubscriptionManagerEndpointAddress}</wsa:Address>
                  <wsa:ReferenceParameters>
                     <nhin:SubscriptionId xmlns:nhin="http://www.hhs.gov/healthit/nhin">${#Project#NotifySubscriptionID}</nhin:SubscriptionId>
                  </wsa:ReferenceParameters>
               </b:SubscriptionReference>
               <b:Message>
                  <payload xmlns:ns10="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:ns11="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns12="urn:ihe:iti:xds-b:2007" xmlns:ns13="http://docs.oasis-open.org/wsn/t-1" xmlns:ns14="http://nhinc.services.com/schema/auditmessage" xmlns:ns17="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns18="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/08/addressing">
                     <payload>${Payload#Payload}</payload>
                  </payload>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:dateOfSignature>${#Project#sigDate}</urn4:dateOfSignature>
            <urn4:expirationDate>${#Project#expireDate}</urn4:expirationDate>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:purposeOfDisclosure>TREATMENT</urn4:purposeOfDisclosure>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:role>Pharmacy</urn4:role>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <urn4:accessConsentPolicy>urn:oid:1.2.3.4</urn4:accessConsentPolicy>
                     <urn4:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep>
      <con:testStep type="mockresponse" name="Notify Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Notify" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:path>/mockNotifyAdapter</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="WSOUTSAML"><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:Acknowledgement/>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match" name="NotifySubscriptionManagerEndpointAddress Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:Address[1]</path><content>${#Project#NotifySubscriptionManagerEndpointAddress}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Topic[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Subscription ID Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
declare namespace SubscriptionId='http://www.hhs.gov/healthit/nhin';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]</path><content>${#Project#NotifySubscriptionID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Payload Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Message[1]/payload[1]/payload[1]</path><content>${Payload#Payload}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion></con:config></con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-30T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-30T04:39:19Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/30/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-29T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-5.3-respond: send message multiple subscribers" searchProperties="true" disabled="true" id="8ee8a230-004c-4168-9da2-86b060990ca9">
      <con:settings/>
      <con:testStep type="groovy" name="update config">
        <con:settings/>
        <con:config>
          <script>def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR']

void UpdateProperty(String directory, String filename, String propertyKey, String propertyValue,context,log) {
			  
   log.info("begin UpdateProperty; directory='" + directory + "';filename='" + filename + "';key='" + propertyKey + "';value='" + propertyValue + "';");
   File file = new File(directory,filename);
   Properties properties = new Properties();
   FileInputStream frPropFile = new FileInputStream(file);
   properties.load(frPropFile);
   properties.setProperty(propertyKey, propertyValue);
   FileOutputStream fwPropFile = new FileOutputStream(file);
   properties.store(fwPropFile, "**DO NOT CHECK IN** - written by groovy script FileUtils.groovy->UpdateProperty");
   properties = null;
}

UpdateProperty(destConfigFileLocation,"gateway.properties","serviceSubscription","true",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","subscriptionPassthrough","false",context,log);
UpdateProperty(destConfigFileLocation,"gateway.properties","hiem.AdapterSubscriptionMode","disabled",context,log);</script>
        </con:config>
      </con:testStep><con:testStep type="groovy" name="Clear Subscription Table">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)
}</script></con:config>
      </con:testStep><con:testStep type="datasource" name="Notify DataSource"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>${projectDir}/HIEMDB.xls</file><worksheet>NotifyMultiple</worksheet><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>id</con:property><con:property>Subscriptionid</con:property><con:property>SubscribeXML</con:property><con:property>SubscriptionReferenceXML</con:property><con:property>RootTopic</con:property><con:property>ParentSubscriptionId</con:property><con:property>ParentSubscriptionReferenceXML</con:property><con:property>Consumer</con:property><con:property>Producer</con:property><con:property>PatientId</con:property><con:property>PatientAssigningAuthority</con:property><con:property>Targets</con:property><con:property>CreationDate</con:property><con:startRow>1</con:startRow><con:endRow/><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Add Subscription">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')

  def id = context.findProperty('id')
  def Subscriptionid = context.findProperty('Subscriptionid')
  def SubscribeXML = context.findProperty('SubscribeXML')
  def SubscriptionReferenceXML = context.findProperty('SubscriptionReferenceXML')
  def RootTopic = context.findProperty('RootTopic')
  def ParentSubscriptionId = context.findProperty('ParentSubscriptionId')
  def ParentSubscriptionReferenceXML = context.findProperty('ParentSubscriptionReferenceXML')
  def Consumer = context.findProperty('Consumer')
  def Producer = context.findProperty('Producer')
  def PatientId = context.findProperty('PatientId')
  def PatientAssigningAuthority = context.findProperty('PatientAssigningAuthority')
  def Targets = context.findProperty('Targets')
  def CreationDate = context.findProperty('CreationDate')

  def insertSql = "insert into " + table + " (id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, "\
    + "ParentSubscriptionId, ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, "\
    + "Targets, CreationDate) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
  sql.executeUpdate(insertSql, [id, Subscriptionid, SubscribeXML, SubscriptionReferenceXML, RootTopic, ParentSubscriptionId,\
    ParentSubscriptionReferenceXML, Consumer, Producer, PatientId, PatientAssigningAuthority, Targets, CreationDate])
}
</script></con:config>
      </con:testStep><con:testStep type="datasourceloop" name="DataSource Loop"><con:settings/><con:config><dataSourceStep>Notify DataSource</dataSourceStep><targetStep>Add Subscription</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (6)">
        <con:settings/>
        <con:config><script>context.withSql('SubscriptionDB') { sql -> 
  assert 6 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}</script></con:config>
      </con:testStep><con:testStep type="groovy" name="Modify Notify Adapter Endpoint">
        <con:settings/>
        <con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );

def destConfigFileLocation = System.env['NHINC_PROPERTIES_DIR'];

def mockHost = context.findProperty("mockHost");
def mockNotifyURL = "http://" + mockHost + ":11223/mockNotifyAdapter";
def LocalHCID = context.findProperty( "LocalHCID" );

FileUtils.CreateOrUpdateConnection(destConfigFileLocation, LocalHCID, "adapternotificationconsumer", mockNotifyURL, context, log)</script></con:config>
      </con:testStep><con:testStep type="properties" name="Payload"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="false" createMissingOnLoad="true" discardValuesOnSave="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:source>${projectDir}/Small_Payload.properties</con:source><con:properties><con:property><con:name>Payload</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>subscriptionCount</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>subscription1</con:name><con:value xsi:nil="true"/></con:property></con:properties></con:config></con:testStep>
      <con:testStep type="groovy" name="Initialize Subscription Count"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
groovyUtils.setPropertyValue( "Payload", "subscriptionCount", "0" );
</script></con:config></con:testStep><con:testStep type="request" name="Notify"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EntityNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:request name="Notify"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-EntityNotify}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:b="http://docs.oasis-open.org/wsn/b-2" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:urn3="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:urn4="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ihe="urn:ihe:iti:xds-b:2007" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0">
   <soapenv:Header/>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-5.3-respond: send message multiple subscribers">
      <urn:NotifyRequest>
         <b:Notify>
            <b:NotificationMessage>
               <b:Topic Dialect="http://docs.oasis-open.org/wsn/t-1/TopicExpression/Simple">${#Project#Topic}</b:Topic>
               <b:Message>
                  <payload xmlns:ns10="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:ns11="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:ns12="urn:ihe:iti:xds-b:2007" xmlns:ns13="http://docs.oasis-open.org/wsn/t-1" xmlns:ns14="http://nhinc.services.com/schema/auditmessage" xmlns:ns17="urn:gov:hhs:fha:nhinc:common:nhinccommonentity" xmlns:ns18="urn:gov:hhs:fha:nhinc:common:subscriptionb2overridefordocuments" xmlns:ns5="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:ns6="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" xmlns:ns7="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" xmlns:ns8="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/08/addressing">
                     <payload>${Payload#Payload}</payload>
                  </payload>
               </b:Message>
            </b:NotificationMessage>
         </b:Notify>
         <urn:Assertion>
            <urn4:address>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>AddrCity</urn4:city>
               <urn4:country>AddrCountry</urn4:country>
               <urn4:state>AddrState</urn4:state>
               <urn4:streetAddress>AddrStreet</urn4:streetAddress>
               <urn4:zipCode>AddrZip</urn4:zipCode>
            </urn4:address>
            <urn4:dateOfBirth>06/04/1959 05:21:00</urn4:dateOfBirth>
            <urn4:dateOfSignature>${#Project#sigDate}</urn4:dateOfSignature>
            <urn4:expirationDate>${#Project#expireDate}</urn4:expirationDate>
            <urn4:explanationNonClaimantSignature>Electronic</urn4:explanationNonClaimantSignature>
            <urn4:haveSecondWitnessSignature>false</urn4:haveSecondWitnessSignature>
            <urn4:haveSignature>false</urn4:haveSignature>
            <urn4:haveWitnessSignature>false</urn4:haveWitnessSignature>
            <urn4:homeCommunity>
               <urn4:description>${#Project#LocalHCDescription}</urn4:description>
               <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
               <urn4:name>${#Project#LocalHCDescription}</urn4:name>
            </urn4:homeCommunity>
            <urn4:personName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sandy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
               <urn4:fullName>Sandy S. Smith</urn4:fullName>
            </urn4:personName>
            <urn4:phoneNumber>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5436</urn4:extension>
               <urn4:localNumber>253-6849</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:phoneNumber>
            <urn4:purposeOfDisclosure>TREATMENT</urn4:purposeOfDisclosure>
            <urn4:secondWitnessAddress>
               <urn4:addressType>
                  <urn4:code>AddrCode</urn4:code>
                  <urn4:codeSystem>AddrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>AddrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>AddrCode</urn4:displayName>
                  <urn4:originalText>AddrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Addr2City</urn4:city>
               <urn4:country>Addr2Country</urn4:country>
               <urn4:state>Addr2State</urn4:state>
               <urn4:streetAddress>Addr2Street</urn4:streetAddress>
               <urn4:zipCode>Addr2Zip</urn4:zipCode>
            </urn4:secondWitnessAddress>
            <urn4:secondWitnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Sammy</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>s</urn4:secondNameOrInitials>
               <urn4:fullName>Sammy S. Smith</urn4:fullName>
            </urn4:secondWitnessName>
            <urn4:secondWitnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>5424</urn4:extension>
               <urn4:localNumber>542-6823</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:secondWitnessPhone>
            <urn4:SSN>253-98-7546</urn4:SSN>
            <urn4:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</urn4:uniquePatientId>
            <urn4:witnessAddress>
               <urn4:addressType>
                  <urn4:code>addrCode</urn4:code>
                  <urn4:codeSystem>addrCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>addrCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>addrCode</urn4:displayName>
                  <urn4:originalText>addrCode</urn4:originalText>
               </urn4:addressType>
               <urn4:city>Burnell</urn4:city>
               <urn4:country>USA</urn4:country>
               <urn4:state>FL</urn4:state>
               <urn4:streetAddress>825 North</urn4:streetAddress>
               <urn4:zipCode>32184</urn4:zipCode>
            </urn4:witnessAddress>
            <urn4:witnessName>
               <urn4:familyName>Smith</urn4:familyName>
               <urn4:givenName>Scott</urn4:givenName>
               <urn4:nameType>
                  <urn4:code>nameCode</urn4:code>
                  <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>nameCode</urn4:displayName>
                  <urn4:originalText>nameCode</urn4:originalText>
               </urn4:nameType>
               <urn4:secondNameOrInitials>S.</urn4:secondNameOrInitials>
               <urn4:fullName>Scott S. Smith</urn4:fullName>
            </urn4:witnessName>
            <urn4:witnessPhone>
               <urn4:areaCode>321</urn4:areaCode>
               <urn4:countryCode>1</urn4:countryCode>
               <urn4:extension>8432</urn4:extension>
               <urn4:localNumber>985-2239</urn4:localNumber>
               <urn4:phoneNumberType>
                  <urn4:code>phoneCode</urn4:code>
                  <urn4:codeSystem>phoneCodeSyst</urn4:codeSystem>
                  <urn4:codeSystemName>phoneCodeSystName</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>phoneCode</urn4:displayName>
                  <urn4:originalText>phoneCode</urn4:originalText>
               </urn4:phoneNumberType>
            </urn4:witnessPhone>
            <urn4:userInfo>
               <urn4:personName>
                  <urn4:familyName>Skagerberg</urn4:familyName>
                  <urn4:givenName>Karl</urn4:givenName>
                  <urn4:nameType>
                     <urn4:code>nameCode</urn4:code>
                     <urn4:codeSystem>nameCodeSyst</urn4:codeSystem>
                     <urn4:codeSystemName>nameCodeSystName</urn4:codeSystemName>
                     <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                     <urn4:displayName>nameCode</urn4:displayName>
                     <urn4:originalText>nameCode</urn4:originalText>
                  </urn4:nameType>
                  <urn4:secondNameOrInitials>S</urn4:secondNameOrInitials>
                  <urn4:fullName>Kasrl S. Skagerberg</urn4:fullName>
               </urn4:personName>
               <urn4:userName>kskagerb</urn4:userName>
               <urn4:role>Pharmacy</urn4:role>
               <urn4:org>
                  <urn4:description>${#Project#LocalHCDescription}</urn4:description>
                  <urn4:homeCommunityId>${#Project#LocalHCID}</urn4:homeCommunityId>
                  <urn4:name>${#Project#LocalHCDescription}</urn4:name>
               </urn4:org>
               <urn4:roleCoded>
                  <urn4:code>307969004</urn4:code>
                  <urn4:codeSystem>2.16.840.1.113883.6.96</urn4:codeSystem>
                  <urn4:codeSystemName>SNOMED_CT</urn4:codeSystemName>
                  <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
                  <urn4:displayName>Public Health</urn4:displayName>
                  <urn4:originalText>Public Health</urn4:originalText>
               </urn4:roleCoded>
            </urn4:userInfo>
            <urn4:authorized>true</urn4:authorized>
            <urn4:purposeOfDisclosureCoded>
               <urn4:code>PUBLICHEALTH</urn4:code>
               <urn4:codeSystem>2.16.840.1.113883.3.18.7.1</urn4:codeSystem>
               <urn4:codeSystemName>nhin-purpose</urn4:codeSystemName>
               <urn4:codeSystemVersion>1.0</urn4:codeSystemVersion>
               <urn4:displayName>Use or disclosure of Psychotherapy Notes</urn4:displayName>
               <urn4:originalText>Use or disclosure of Psychotherapy Notes</urn4:originalText>
            </urn4:purposeOfDisclosureCoded>
            <urn4:samlAuthnStatement>
               <urn4:authInstant>2009-04-16T13:15:39Z</urn4:authInstant>
               <urn4:sessionIndex>987</urn4:sessionIndex>
               <urn4:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</urn4:authContextClassRef>
               <urn4:subjectLocalityAddress>158.147.185.168</urn4:subjectLocalityAddress>
               <urn4:subjectLocalityDNSName>cs.myharris.net</urn4:subjectLocalityDNSName>
            </urn4:samlAuthnStatement>
            <urn4:samlAuthzDecisionStatement>
               <urn4:decision>Permit</urn4:decision>
               <urn4:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</urn4:resource>
               <urn4:action>TestSaml</urn4:action>
               <urn4:evidence>
                  <urn4:assertion>
                     <urn4:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</urn4:id>
                     <urn4:issueInstant>2009-04-16T13:10:39.093Z</urn4:issueInstant>
                     <urn4:version>2.0</urn4:version>
                     <urn4:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</urn4:issuerFormat>
                     <urn4:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</urn4:issuer>
                     <urn4:conditions>
                        <urn4:notBefore>2009-04-16T13:10:39.093Z</urn4:notBefore>
                        <urn4:notOnOrAfter>2009-12-31T12:00:00.000Z</urn4:notOnOrAfter>
                     </urn4:conditions>
                     <urn4:accessConsentPolicy>urn:oid:1.2.3.4</urn4:accessConsentPolicy>
                     <urn4:instanceAccessConsentPolicy>urn:oid:1.2.3.4.123456789</urn4:instanceAccessConsentPolicy>
                  </urn4:assertion>
               </urn4:evidence>
            </urn4:samlAuthzDecisionStatement>
         </urn:Assertion>
      </urn:NotifyRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="Schema Compliance"><con:configuration/></con:assertion><con:assertion type="SOAP Fault Assertion"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="mockresponse" name="Notify Response"><con:settings/><con:config xsi:type="con:MockResponseStep" startStep="Initialize Subscription Count" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AdapterNotificationConsumerBindingSoap</con:interface><con:operation>Notify</con:operation><con:path>/mockNotifyAdapter</con:path><con:port>11223</con:port><con:timeout>10000</con:timeout><con:response outgoingWss="" httpResponseStatus=""><con:settings/><con:responseContent><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommon">
   <soap:Header/>
   <soap:Body>
      <urn:Acknowledgement/>
   </soap:Body>
</soap:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508"/></con:response><con:assertion type="XPath Match" name="NotifySubscriptionManagerEndpointAddress Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:Address[1]</path><content>${#Project#NotifySubscriptionManagerEndpointAddress}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Topic Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Topic[1]</path><content>${#Project#Topic}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Subscription ID Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
declare namespace ns9='http://www.w3.org/2005/08/addressing';
declare namespace SubscriptionId='http://www.hhs.gov/healthit/nhin';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]</path><content>${#Project#NotifySubscriptionID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="XPath Match" name="Payload Match"><con:configuration><path>declare namespace ns16='urn:gov:hhs:fha:nhinc:common:nhinccommonadapter';
declare namespace ns10='http://docs.oasis-open.org/wsn/b-2';
//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:Message[1]/payload[1]/payload[1]</path><content>${Payload#Payload}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion"><con:configuration><scriptText>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder( messageExchange.requestContent )
holder.namespaces["ns16"]="urn:gov:hhs:fha:nhinc:common:nhinccommonadapter"
holder.namespaces["ns10"]="http://docs.oasis-open.org/wsn/b-2"
holder.namespaces["ns9"]="http://www.w3.org/2005/08/addressing"
holder.namespaces["SubscriptionId"]="http://www.hhs.gov/healthit/nhin"
def subscriptionId = holder["//ns16:NotifyRequest[1]/ns10:Notify[1]/ns10:NotificationMessage[1]/ns10:SubscriptionReference[1]/ns9:ReferenceParameters[1]/SubscriptionId:SubscriptionId[1]"]
def subscriptionCount = context.getProperty( "Payload", "subscriptionCount" )
subscriptionCount++
groovyUtils.setPropertyValue( "Payload", "subscriptionCount", subscriptionCount )
groovyUtils.setPropertyValue( "Payload", "subscription" + subscriptionCount, subscriptionId.toString() )

assert (subscriptionId.size() != 0)
</scriptText></con:configuration></con:assertion></con:config></con:testStep><con:properties>
        <con:property>
          <con:name>startDate</con:name>
          <con:value>2010-08-31T00:00:00Z</con:value>
        </con:property>
        <con:property>
          <con:name>endDate</con:name>
          <con:value>2010-08-31T04:21:40Z</con:value>
        </con:property>
        <con:property>
          <con:name>sigDate</con:name>
          <con:value>08/31/2010 00:00:00</con:value>
        </con:property>
        <con:property>
          <con:name>expireDate</con:name>
          <con:value>2010-09-30T00:00:00Z</con:value>
        </con:property>
      </con:properties>
      <con:reportParameters/>
    </con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="HMR-6.1-respond: unsubscribe" searchProperties="true" id="1f230d3f-22ce-4c47-8f2b-8adf701059de"><con:settings/><con:testStep type="groovy" name="Clear Subscription Table &amp; Add Sub"><con:settings/><con:config><script>context.withSql('SubscriptionDB') { sql -> 
  def table = context.findProperty('SubscriptionTable')
  
  sql.execute('delete from ' + table)

  def unSubscriptionID = context.findProperty( "UnSubscriptionID" )
  def startDate = Date.parse("yyyy-MM-dd'T'HH:mm:ss'Z'", context.findProperty("startDate"))
  def insertSql = "insert into " + table + " (id, Subscriptionid, RootTopic, Consumer, Producer, CreationDate) " + 
                   "values (1, ?, 'SomeTopic', 'nhin', 'gateway', ?)"
  sql.executeUpdate(insertSql, [unSubscriptionID, startDate])
}</script></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (1)"><con:settings/><con:config><script>
context.withSql('SubscriptionDB') { sql -> 
  assert 1 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}

</script></con:config></con:testStep><con:testStep type="request" name="Unsubscribe"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>NhincProxySubscriptionManagerBindingSoap</con:interface><con:operation>Unsubscribe</con:operation><con:request name="Unsubscribe"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#Endpoint-NHINCProxyUnsubscribe}</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:nhin="http://www.hhs.gov/healthit/nhin" xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" xmlns:urn="urn:gov:hhs:fha:nhinc:common:nhinccommonproxy" xmlns:urn1="urn:gov:hhs:fha:nhinc:common:subscription" xmlns:urn2="urn:gov:hhs:fha:nhinc:common:nhinccommon" xmlns:add="http://schemas.xmlsoap.org/ws/2004/08/addressing">
   <soapenv:Header>
      <ns5:SubscriptionId xmlns="http://www.w3.org/2005/08/addressing" xmlns:ns2="http://docs.oasis-open.org/wsn/b-2" xmlns:ns3="http://docs.oasis-open.org/wsrf/bf-2" xmlns:ns4="http://docs.oasis-open.org/wsn/t-1" xmlns:ns5="http://www.hhs.gov/healthit/nhin">${#Project#UnSubscriptionID}</ns5:SubscriptionId>
      <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">hello world</nhinconnect:Info>
   </soapenv:Header>
   <soapenv:Body projectName="HIEMConformanceTests" testCase="HMR-6.1-respond: unsubscribe">
      <urn:UnsubscribeRequest>
         <wsnt:Unsubscribe xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
            <nhinconnect:Info xmlns:nhinconnect="urn:nhinconnect">just some data</nhinconnect:Info>
         </wsnt:Unsubscribe>
         <urn:assertion>
            <nccommon:address xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>AddrCity</nccommon:city>
               <nccommon:country>AddrCountry</nccommon:country>
               <nccommon:state>AddrState</nccommon:state>
               <nccommon:streetAddress>AddrStreet</nccommon:streetAddress>
               <nccommon:zipCode>AddrZip</nccommon:zipCode>
            </nccommon:address>
            <nccommon:dateOfBirth xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">06/04/1959 05:21:00</nccommon:dateOfBirth>
            <nccommon:explanationNonClaimantSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">Electronic</nccommon:explanationNonClaimantSignature>
            <nccommon:haveSecondWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSecondWitnessSignature>
            <nccommon:haveSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveSignature>
            <nccommon:haveWitnessSignature xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">false</nccommon:haveWitnessSignature>
            <nccommon:homeCommunity xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
               <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
               <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
            </nccommon:homeCommunity>
            <nccommon:personName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sandy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sandy S. Smith</nccommon:fullName>
            </nccommon:personName>
            <nccommon:phoneNumber xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5436</nccommon:extension>
               <nccommon:localNumber>253-6849</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:phoneNumber>
            <nccommon:secondWitnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>AddrCode</nccommon:code>
                  <nccommon:codeSystem>AddrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>AddrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>AddrCode</nccommon:displayName>
                  <nccommon:originalText>AddrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Addr2City</nccommon:city>
               <nccommon:country>Addr2Country</nccommon:country>
               <nccommon:state>Addr2State</nccommon:state>
               <nccommon:streetAddress>Addr2Street</nccommon:streetAddress>
               <nccommon:zipCode>Addr2Zip</nccommon:zipCode>
            </nccommon:secondWitnessAddress>
            <nccommon:secondWitnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Sammy</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>s</nccommon:secondNameOrInitials>
               <nccommon:fullName>Sammy S. Smith</nccommon:fullName>
            </nccommon:secondWitnessName>
            <nccommon:secondWitnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>5424</nccommon:extension>
               <nccommon:localNumber>542-6823</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:secondWitnessPhone>
            <nccommon:SSN xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">253-98-7546</nccommon:SSN>
            <nccommon:uniquePatientId xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">500000000^^^&amp;1.1&amp;ISO</nccommon:uniquePatientId>
            <nccommon:witnessAddress xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:addressType>
                  <nccommon:code>addrCode</nccommon:code>
                  <nccommon:codeSystem>addrCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>addrCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>addrCode</nccommon:displayName>
                  <nccommon:originalText>addrCode</nccommon:originalText>
               </nccommon:addressType>
               <nccommon:city>Burnell</nccommon:city>
               <nccommon:country>USA</nccommon:country>
               <nccommon:state>FL</nccommon:state>
               <nccommon:streetAddress>825 North</nccommon:streetAddress>
               <nccommon:zipCode>32184</nccommon:zipCode>
            </nccommon:witnessAddress>
            <nccommon:witnessName xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:familyName>Smith</nccommon:familyName>
               <nccommon:givenName>Scott</nccommon:givenName>
               <nccommon:nameType>
                  <nccommon:code>nameCode</nccommon:code>
                  <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>nameCode</nccommon:displayName>
                  <nccommon:originalText>nameCode</nccommon:originalText>
               </nccommon:nameType>
               <nccommon:secondNameOrInitials>S.</nccommon:secondNameOrInitials>
               <nccommon:fullName>Scott S. Smith</nccommon:fullName>
            </nccommon:witnessName>
            <nccommon:witnessPhone xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:areaCode>321</nccommon:areaCode>
               <nccommon:countryCode>1</nccommon:countryCode>
               <nccommon:extension>8432</nccommon:extension>
               <nccommon:localNumber>985-2239</nccommon:localNumber>
               <nccommon:phoneNumberType>
                  <nccommon:code>phoneCode</nccommon:code>
                  <nccommon:codeSystem>phoneCodeSyst</nccommon:codeSystem>
                  <nccommon:codeSystemName>phoneCodeSystName</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>phoneCode</nccommon:displayName>
                  <nccommon:originalText>phoneCode</nccommon:originalText>
               </nccommon:phoneNumberType>
            </nccommon:witnessPhone>
            <nccommon:userInfo xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:personName>
                  <nccommon:familyName>Skagerberg</nccommon:familyName>
                  <nccommon:givenName>Karl</nccommon:givenName>
                  <nccommon:nameType>
                     <nccommon:code>nameCode</nccommon:code>
                     <nccommon:codeSystem>nameCodeSyst</nccommon:codeSystem>
                     <nccommon:codeSystemName>nameCodeSystName</nccommon:codeSystemName>
                     <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                     <nccommon:displayName>nameCode</nccommon:displayName>
                     <nccommon:originalText>nameCode</nccommon:originalText>
                  </nccommon:nameType>
                  <nccommon:secondNameOrInitials>S</nccommon:secondNameOrInitials>
                  <nccommon:fullName>Kasrl S. Skagerberg</nccommon:fullName>
               </nccommon:personName>
               <nccommon:userName>kskagerb</nccommon:userName>
               <nccommon:org>
                  <nccommon:description>${#Project#RemoteHCDescription}</nccommon:description>
                  <nccommon:homeCommunityId>${#Project#RemoteHCID}</nccommon:homeCommunityId>
                  <nccommon:name>${#Project#RemoteHCDescription}</nccommon:name>
               </nccommon:org>
               <nccommon:roleCoded>
                  <nccommon:code>307969004</nccommon:code>
                  <nccommon:codeSystem>2.16.840.1.113883.6.96</nccommon:codeSystem>
                  <nccommon:codeSystemName>SNOMED_CT</nccommon:codeSystemName>
                  <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
                  <nccommon:displayName>Public Health</nccommon:displayName>
                  <nccommon:originalText>Public Health</nccommon:originalText>
               </nccommon:roleCoded>
            </nccommon:userInfo>
            <nccommon:authorized xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">true</nccommon:authorized>
            <nccommon:purposeOfDisclosureCoded xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:code>PUBLICHEALTH</nccommon:code>
               <nccommon:codeSystem>2.16.840.1.113883.3.18.7.1</nccommon:codeSystem>
               <nccommon:codeSystemName>nhin-purpose</nccommon:codeSystemName>
               <nccommon:codeSystemVersion>1.0</nccommon:codeSystemVersion>
               <nccommon:displayName>Use or disclosure of Psychotherapy Notes</nccommon:displayName>
               <nccommon:originalText>Use or disclosure of Psychotherapy Notes</nccommon:originalText>
            </nccommon:purposeOfDisclosureCoded>
            <nccommon:samlAuthnStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:authInstant>2009-04-16T13:15:39Z</nccommon:authInstant>
               <nccommon:sessionIndex>987</nccommon:sessionIndex>
               <nccommon:authContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</nccommon:authContextClassRef>
               <nccommon:subjectLocalityAddress>158.147.185.168</nccommon:subjectLocalityAddress>
               <nccommon:subjectLocalityDNSName>cs.myharris.net</nccommon:subjectLocalityDNSName>
            </nccommon:samlAuthnStatement>
            <nccommon:samlAuthzDecisionStatement xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
               <nccommon:decision>Permit</nccommon:decision>
               <nccommon:resource>https://158.147.185.168:8181/SamlReceiveService/SamlProcessWS</nccommon:resource>
               <nccommon:action>TestSaml</nccommon:action>
               <nccommon:evidence>
                  <nccommon:assertion>
                     <nccommon:id>40df7c0a-ff3e-4b26-baeb-f2910f6d05a9</nccommon:id>
                     <nccommon:issueInstant>2009-04-16T13:10:39.093Z</nccommon:issueInstant>
                     <nccommon:version>2.0</nccommon:version>
                     <nccommon:issuerFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</nccommon:issuerFormat>
                     <nccommon:issuer>CN=SAML User,OU=Harris,O=HITS,L=Melbourne,ST=FL,C=US</nccommon:issuer>
                     <nccommon:conditions>
                        <nccommon:notBefore>2009-04-16T13:10:39.093Z</nccommon:notBefore>
                        <nccommon:notOnOrAfter>2009-12-31T12:00:00.000Z</nccommon:notOnOrAfter>
                     </nccommon:conditions>
                     <nccommon:accessConsentPolicy>Claim-Ref-1234</nccommon:accessConsentPolicy>
                     <nccommon:instanceAccessConsentPolicy>Claim-Instance-1</nccommon:instanceAccessConsentPolicy>
                  </nccommon:assertion>
               </nccommon:evidence>
            </nccommon:samlAuthzDecisionStatement>
         </urn:assertion>
         <urn:nhinTargetSystem>
            <urn2:homeCommunity>
               <urn2:description>${#Project#LocalHCDescription}</urn2:description>
               <urn2:homeCommunityId>${#Project#LocalHCID}</urn2:homeCommunityId>
               <urn2:name>${#Project#LocalHCDescription}</urn2:name>
            </urn2:homeCommunity>
         </urn:nhinTargetSystem>
      </urn:UnsubscribeRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:assertion type="SOAP Fault Assertion"/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:assertion type="Schema Compliance"><con:configuration><definition/></con:configuration></con:assertion><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="Count Subscriptions (0)"><con:settings/><con:config><script>
context.withSql('SubscriptionDB') { sql -> 
  assert 0 == sql.firstRow('select count(*) from ' + context.findProperty('SubscriptionTable'))[0]
}
</script></con:config></con:testStep><con:properties><con:property><con:name>startDate</con:name><con:value>2010-08-30T00:00:00Z</con:value></con:property><con:property><con:name>endDate</con:name><con:value>2010-08-30T04:39:26Z</con:value></con:property><con:property><con:name>sigDate</con:name><con:value>08/30/2010 00:00:00</con:value></con:property><con:property><con:name>expireDate</con:name><con:value>2010-09-29T00:00:00Z</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties/><con:setupScript/><con:reportParameters/></con:testSuite><con:requirements/><con:properties><con:property><con:name>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</con:name><con:value>.mine</con:value></con:property><con:property><con:name>>>>>>>></con:name><con:value>.r5443</con:value></con:property><con:property><con:name>AQPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>AQUserID</con:name><con:value>kskagerb</con:value></con:property><con:property><con:name>AuditDB</con:name><con:value>auditrepo</con:value></con:property><con:property><con:name>AuditTable</con:name><con:value>auditrepository</con:value></con:property><con:property><con:name>BirthTime</con:name><con:value>19630804</con:value></con:property><con:property><con:name>City</con:name><con:value>Melbourne</con:value></con:property><con:property><con:name>Country</con:name><con:value>US</con:value></con:property><con:property><con:name>DateOfSignature</con:name><con:value>20080520</con:value></con:property><con:property><con:name>DBHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>DBPass</con:name><con:value>nhincpass</con:value></con:property><con:property><con:name>DBPort</con:name><con:value>3306</con:value></con:property><con:property><con:name>DBUser</con:name><con:value>nhincuser</con:value></con:property><con:property><con:name>DOB</con:name><con:value>19800516</con:value></con:property><con:property><con:name>DQDocID</con:name><con:value>1.123401.11111</con:value></con:property><con:property><con:name>DQPatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>DRDocID</con:name><con:value>1.123407.777777</con:value></con:property><con:property><con:name>DRRepoID</con:name><con:value>1</con:value></con:property><con:property><con:name>DynamicDQDocID</con:name><con:value>103.8.9284320.020.3590.75^1266324032288</con:value></con:property><con:property><con:name>DynamicDRDocID</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>Endpoint-AuditLogQuery</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyAuditQuery</con:value></con:property><con:property><con:name>Endpoint-DocQuery</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyDocQuery</con:value></con:property><con:property><con:name>Endpoint-DocRetrieve</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyDocRetrieve</con:value></con:property><con:property><con:name>Endpoint-EntityNotify</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntityNotificationConsumer</con:value></con:property><con:property><con:name>Endpoint-EntitySubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntityNotificationProducer</con:value></con:property><con:property><con:name>Endpoint-EntityUnsubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntitySubscriptionManager</con:value></con:property><con:property><con:name>Endpoint-NHINCProxyNotify</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationConsumer</con:value></con:property><con:property><con:name>Endpoint-NHINCProxySubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationProducer</con:value></con:property><con:property><con:name>Endpoint-NHINCProxyUnsubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxySubscriptionManager</con:value></con:property><con:property><con:name>Endpoint-NhincProxyXDRRequest</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/EntityProxyService/NhincProxyXDRRequest</con:value></con:property><con:property><con:name>Endpoint-Notify</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationConsumer</con:value></con:property><con:property><con:name>Endpoint-PatientDiscovery</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyPatientDiscovery</con:value></con:property><con:property><con:name>Endpoint-PatientDiscoveryAsyncReq</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyPatientDiscoveryAsyncReq</con:value></con:property><con:property><con:name>Endpoint-PatientDiscoveryAsyncResp</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxyPatientDiscoveryAsyncResp</con:value></con:property><con:property><con:name>Endpoint-Reidentification</con:name><con:value>http://connectred30.fedsconnect.org:8080/CONNECTAdapter/NhincProxySubjectDiscovery</con:value></con:property><con:property><con:name>Endpoint-Subscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxyNotificationProducer</con:value></con:property><con:property><con:name>Endpoint-Unsubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/NhincProxySubscriptionManager</con:value></con:property><con:property><con:name>EntitySubscribe</con:name><con:value>http://localhost:8080/CONNECTAdapter/EntityNotificationProducer</con:value></con:property><con:property><con:name>ExpirationDate</con:name><con:value>20100520</con:value></con:property><con:property><con:name>FamilyName</con:name><con:value>Younger</con:value></con:property><con:property><con:name>Gender</con:name><con:value>M</con:value></con:property><con:property><con:name>GivenName</con:name><con:value>Gallow</con:value></con:property><con:property><con:name>LocalAA</con:name><con:value>1.1</con:value></con:property><con:property><con:name>LocalConfigDir</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>LocalHCDescription</con:name><con:value>InternalTest1</con:value></con:property><con:property><con:name>LocalHCID</con:name><con:value>1.1</con:value></con:property><con:property><con:name>mockHost</con:name><con:value>localhost</con:value></con:property><con:property><con:name>mockPort</con:name><con:value>11222</con:value></con:property><con:property><con:name>MPIDir</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>NHINGatewayConfigDir</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>NotificationEndpoint</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/NotificationConsumerService/HiemNotify</con:value></con:property><con:property><con:name>NotifySubscriptionID</con:name><con:value>41def7d2-335b-4638-97c4-11afeade9776</con:value></con:property><con:property><con:name>NotifySubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>PatientCorrelationDB</con:name><con:value>patientcorrelationdb</con:value></con:property><con:property><con:name>PatientCorrelationTable</con:name><con:value>correlatedidentifiers</con:value></con:property><con:property><con:name>PseudonymAA</con:name><con:value>ABC</con:value></con:property><con:property><con:name>PseudonymPatientID</con:name><con:value>PSEUDO001</con:value></con:property><con:property><con:name>PurposeOfDisclosure</con:name><con:value>Mental</con:value></con:property><con:property><con:name>RealAA</con:name><con:value>1.1.1</con:value></con:property><con:property><con:name>RealPatientID</con:name><con:value>D1234010050</con:value></con:property><con:property><con:name>RemoteAA</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemoteHCDescription</con:name><con:value>InternalTest2</con:value></con:property><con:property><con:name>RemoteHCID</con:name><con:value>2.2</con:value></con:property><con:property><con:name>RemoteSubID</con:name><con:value>b4ac316b-d4eb-4d17-ab49-55edb2454114</con:value></con:property><con:property><con:name>SSN</con:name><con:value>123456789</con:value></con:property><con:property><con:name>State</con:name><con:value>FL</con:value></con:property><con:property><con:name>StreetAddress</con:name><con:value>123 Johnson Rd</con:value></con:property><con:property><con:name>SubjectID</con:name><con:value>1111</con:value></con:property><con:property><con:name>SubscribePatientID</con:name><con:value>D123401</con:value></con:property><con:property><con:name>SubscriptionDB</con:name><con:value>subscriptionrepository</con:value></con:property><con:property><con:name>SubscriptionEndpoint</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/NotificationProducerService/HiemSubscription</con:value></con:property><con:property><con:name>SubscriptionManagerEndpointAddress</con:name><con:value>https://localhost:8181/CONNECTNhinServicesWeb/NhinService/SubscriptionManagerService/HiemUnsubscribe</con:value></con:property><con:property><con:name>SubscriptionTable</con:name><con:value>subscription</con:value></con:property><con:property><con:name>Topic</con:name><con:value>SomeTopic</con:value></con:property><con:property><con:name>UniquePatientId</con:name><con:value>1111^^^&amp;amp;1.1&amp;amp;ISO</con:value></con:property><con:property><con:name>UnSubscriptionID</con:name><con:value>54ccad24-ef87-49d0-9c12-c1d06cdf4c67</con:value></con:property><con:property><con:name>UnsubSubscriptionID</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>ZipCode</con:name><con:value>12345</con:value></con:property><con:property><con:name>projectPath</con:name><con:value>F:\SoapUI_Test\ConformanceSuite\HIEMConformanceTests-soapui-project.xml</con:value></con:property><con:property><con:name>NonexistentTopic</con:name><con:value>NonexistentTopic</con:value></con:property><con:property><con:name>TopicNotSupportedMessage</con:name><con:value>Unknown topic</con:value></con:property></con:properties><con:afterLoadScript>project.setPropertyValue("projectPath", project.path)

def propertiesFilename = project.path[0..(project.path.size()-4)] + 'properties'
def propertiesFile = new File(propertiesFilename)
if (propertiesFile.exists()) {
	def props = new Properties()
	props.load(new FileReader(propertiesFile))
	props.each { key, value ->
	    project.setPropertyValue(key, value)
	}
}


TimeZone.setDefault(TimeZone.getTimeZone("UTC"))
def testRunListener = [
  afterRun: { testRunner, runContext -> },
  afterStep: { testRunner, runContext, result -> },
  beforeStep: { testRunner, runContext -> },
  beforeStep: { testRunner, runContext, testStep -> },
  beforeRun: { testRunner, runContext -> 
    use (org.codehaus.groovy.runtime.TimeCategory) {
      def startDate = 5.minutes.ago
      def endDate = 5.minutes.from.now
      def expireDate = 30.days.from.now

      def df = "yyyy-MM-dd'T'HH:mm:ss'Z'"
      def dfSig = "MM/dd/yyyy' 'HH:mm:ss"

      runContext.testCase.setPropertyValue("startDate", startDate.format(df))
      runContext.testCase.setPropertyValue("endDate", endDate.format(df))
      runContext.testCase.setPropertyValue("sigDate", startDate.format(dfSig))
      runContext.testCase.setPropertyValue("expireDate", expireDate.format(df))
    }
  }   
] as com.eviware.soapui.model.testsuite.TestRunListener

project.testSuiteList*.testCaseList.flatten()*.addTestRunListener(testRunListener)



com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.findProperty = { propertyName ->
    return delegate.getProperty(propertyName) ?:
                delegate.testCase.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.getPropertyValue(propertyName) ?:
                delegate.testCase.testSuite.project.getPropertyValue(propertyName)
}

com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext.metaClass.withSql = { dbOrPropertyName, block ->
  def dbName = delegate.findProperty(dbOrPropertyName) ?: dbOrPropertyName
  def host = delegate.findProperty('DBHost')
  def port = delegate.findProperty('DBPort')
  def user = delegate.findProperty('DBUser')
  def pass = delegate.findProperty('DBPass')
  
  def connectString = "jdbc:mysql://${host}:${port}/${dbName}"
  def sql = groovy.sql.Sql.newInstance(connectString, user, pass, "com.mysql.jdbc.Driver");
  try {
     block(sql)
  } finally {
    sql.close()
  }
}
</con:afterLoadScript><con:wssContainer><con:outgoing><con:name>WSOUTSAML</con:name><con:entry type="Timestamp"><con:configuration><timeToLive>300</timeToLive><strictTimestamp>true</strictTimestamp></con:configuration></con:entry></con:outgoing></con:wssContainer><con:databaseConnectionContainer/><con:reporting><con:reportTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:xmlTemplates/><con:parameters/></con:reporting><con:eventHandlers type="TestSuiteRunListener.beforeTestCase" name="TestSuiteRunListener.beforeTestCase"><con:script disabled="true">FileUtils.backupConfiguration(context, log);</con:script></con:eventHandlers><con:eventHandlers type="TestSuiteRunListener.afterTestCase" name="TestSuiteRunListener.afterTestCase"><con:script disabled="true">FileUtils.restoreConfiguration(context, log);</con:script></con:eventHandlers><con:eventHandlers type="TestSuiteRunListener.beforeRun" name="TestSuiteRunListener.beforeRun"><con:script disabled="true">FileUtils.backupConfiguration(context, log);</con:script></con:eventHandlers><con:eventHandlers type="TestSuiteRunListener.afterRun" name="TestSuiteRunListener.afterRun"><con:script disabled="true">FileUtils.restoreConfiguration(context, log);</con:script></con:eventHandlers><con:eventHandlers type="TestRunListener.beforeRun" name="TestRunListener.beforeRun"><con:script>FileUtils.backupConfiguration(context, log);</con:script></con:eventHandlers><con:eventHandlers type="TestRunListener.afterRun" name="TestRunListener.afterRun"><con:script>FileUtils.restoreConfiguration(context, log);</con:script></con:eventHandlers></con:soapui-project>